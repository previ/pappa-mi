var current_user="",appInit=!1;function setCookie(a,b,c){var d=new Date;d.setDate(d.getDate()+c);b=escape(b)+(null==c?"":"; expires="+d.toUTCString());document.cookie=a+"="+b}function getCookie(a){var b,c,d,e=document.cookie.split(";");for(b=0;b<e.length;b++)if(c=e[b].substr(0,e[b].indexOf("=")),d=e[b].substr(e[b].indexOf("=")+1),c=c.replace(/^\s+|\s+$/g,""),c==a)return unescape(d)}function isUserLogged(){return"O"!=current_user.type}function isUserCM(){return"C"==current_user.type}
function loadUser(a){$.ajax({url:"/api/user/current",dataType:"json",success:function(b){current_user=b;$(".user_info").append($('<img class="avatar"></img>').attr("src",current_user.avatar));$(".user_info").append($("<span></span>").text(current_user.fullname));a()}})}
function loadSchoolList(a){$.ajax({url:"/api/school/"+current_user.city+"/list",dataType:"json",success:function(b){var c=$("#school_list"),d;for(d in b)d=b[d],c.append('<li><a href="#" data-school-id="'+d.id+'">'+d.name+"</a></li>");c.find("a").on("click",onSchoolSelected);a&&a()}})}
function loadNodeList(a){$.mobile.showPageLoadingMsg();$.ajax({url:"/api/node/list",dataType:"json",success:function(b){var c=$("#node_lists"),d=$('<div data-role="collapsible"></div>');d.append("<h2>I tuoi argomenti</h2>");c.append(d);var e=$('<ul data-role="listview" data-divider-theme="d"></ul>'),g=$("#node");d.append(e);if(isUserLogged()){var f=$('<li data-mini="true"><a href="#" data-node-id="all">I tuoi argomenti</a></li>');f.find("a").on("click",onNodeClick);e.append(f)}f=$('<li data-mini="true"><a href="#" data-node-id="news">Tutte le novit\u00e0</a></li>');
f.find("a").on("click",onNodeClick);e.append(f);if(b.subs_nodes.length){for(f=0;f<b.subs_nodes.length;f++){var h=b.subs_nodes[f],k=$('<li data-mini="true"></li>'),l=$('<a href="#"></a>').attr("data-node-id",h.id).text(h.name).on("click",onNodeClick);k.append(l);e.append(k);g.append($("<option></option>").attr("value",h.id).text(h.name))}d.append(e)}if(b.active_nodes.length){d=$('<div data-role="collapsible"></div>');d.append("<h2>Pi\u00f9 attivi</h2>");c.append(d);e=$('<ul data-role="listview" data-divider-theme="d"></ul>');
for(f=0;f<(5<b.active_nodes.length?5:b.active_nodes.length);f++)h=b.active_nodes[f],k=$('<li data-mini="true"></li>'),l=$('<a href="#"></a>').attr("data-node-id",h.id).text(h.name).on("click",onNodeClick),k.append(l),e.append(k);d.append(e)}if(b.recent_nodes.length){d=$('<div data-role="collapsible"></div>');d.append("<h2>Pi\u00f9 recenti</h2>");c.append(d);e=$('<ul data-role="listview" data-divider-theme="d"></ul>');for(f=0;f<(5<b.recent_nodes.length?5:b.recent_nodes.length);f++)h=b.recent_nodes[f],
k=$('<li data-mini="true"></li>'),l=$('<a href="#"></a>').attr("data-node-id",h.id).text(h.name).on("click",onNodeClick),k.append(l),e.append(k);d.append(e)}$("#node-panel").trigger("create");$.mobile.hidePageLoadingMsg();a&&a()}})}
function onSchoolSelected(){current_user.schools=[{id:$(this).attr("data-school-id"),name:$(this).text()}];setCookie("school_id",current_user.schools[0].id,365);setCookie("school_name",current_user.schools[0].name,365);var a=new Date;initMenu(current_user,current_user.schools[0].id,getPrevBizDay(new Date(a.getFullYear(),a.getMonth(),a.getDate())));$.mobile.changePage("#page-menu")}
function checkMenuHelp(){var a=getCookie("menuhelp");a||($("#menu-help").popup({history:!1}),$("#menu-help").popup("open",{transition:"slideup",positionTo:"window"}),a=!0);setCookie("menuhelp",a,365)}
function initApp(){appInit||loadUser(function(){!isUserLogged()&&getCookie("school_id")&&(current_user.schools=[{id:getCookie("school_id"),name:getCookie("school_name")}]);if(isUserLogged()||getCookie("school_id")){var a=new Date;initMenu(current_user,current_user.schools[0].id,getPrevBizDay(new Date(a.getFullYear(),a.getMonth(),a.getDate())))}else $.mobile.showPageLoadingMsg(),loadSchoolList(function(){$.mobile.changePage("#page-school-chooser",{transition:"fade"});$.mobile.hidePageLoadingMsg()});
appInit=!0})}$(document).on("mobileinit",function(){getVotesTag();$.mobile.loader.prototype.options.text="caricamento";$.mobile.loader.prototype.options.theme="a";initApp()});$(document).on("pageshow","#page-menu",function(a){appInit&&checkMenuHelp()});
$(document).on("pageinit","#page-menu",function(a){$("#page-menu").on("swipeleft",function(a){$.mobile.showPageLoadingMsg();var c=$("#data");a=$("#cm");c=getDateFromStr(c.val());(c=getNextBizDay(new Date(c.getFullYear(),c.getMonth(),c.getDate()+1)))&&initMenu(current_user,a.val(),c)});$("#page-menu").on("swiperight",function(a){$.mobile.showPageLoadingMsg();var c=$("#data");a=$("#cm");c=getDateFromStr(c.val());(c=getPrevBizDay(new Date(c.getFullYear(),c.getMonth(),c.getDate()-1)))&&initMenu(current_user,
a.val(),c)})});
$(document).on("pageinit","#page-stream",function(a){initCheck();loadNodeList();loadNode("news");isUserLogged()&&$("#page-stream-content").prepend('<a data-role="button" data-transition="flip" href="#page-post-new" id="create_new">Nuovo messaggio</a>');$("#page-stream").trigger("create");$("#post_delete").on("click",onPostDelete);$("#post_reshare").on("click",onPostReshare);$("#post_comment_submit").on("click",onPostCommentSubmit);$("#post_comments_expand").on("click",onPostShowComments);$("#post_vote").on("click",
onPostVote);$("#post_votes_expand").on("click",onPostShowVotes);$("#post_unvote").on("click",onPostVote)});var channel="";function initCheck(a,b){""==current_user&&(window.location.href="/mobile/app")}$(document).on("pageinit","#page-dish-detail",function(){initCheck();$(".dish_stat").on("click",onDishStat);$(".dish_vote").on("click",onDishVote)});$(document).on("pageinit","#page-dish-stat",initCheck);$(document).on("pageinit","#page-dish-vote",initCheck);
$(document).on("pageinit","#page-notifiche",function(a,b){initCheck();$.ajax({url:"/api/user/online/list",dataType:"json",success:function(a){var b=$("#user_list"),c=$("#user_to");b.append('<li data-role="list-divider">In linea</li>');for(var f in a){var h=a[f],k=$("<li></li>"),l=$('<a href="#"></a>').attr("data-user-id",f).text(h.name).on("click",onUserClick);k.append(l);b.append(k);c.append($("<option></option>").attr("value",f).text("A: "+h.name))}b.listview("refresh");c.selectmenu()}});$("#message_form").on("submit",
function(){onMessageSend();return!1});var c=$("body").attr("data-channel-id");""==channel&&""!=c&&(channel=openChannel(c))});function onPostDelete(){var a=$(this).parents("[data-post-id]").attr("data-post-id");confirm("Cancellare il post?")&&$.ajax({url:"/api/post/"+a+"/delete",dataType:"json",success:function(a){$.mobile.navigate("/mobile/app")}})}
function onPostReshare(){var a=$(this).parents("[data-post-id]").attr("data-post-id");$("#form_post_reshare").attr("action","/api/post/"+a+"/reshare");$("#post_reshare_title").val($("#post_title").text());$("#post_reshared_title").text($("#post_title").text());$("#post_reshared_content").text($("#post_content").text());$("#post_reshare_node").empty().append($("#node").children().clone());$("#form_post_reshare").ajaxForm({dataType:"json",success:function(a){a=a.post;$("#post_list").prepend(createPostItem(a));
$("#post_list").listview("refresh");$.mobile.changePage("#page-stream")}});$.mobile.changePage("#page-post-reshare")}function onPostVote(){var a=$(this).parents("[data-post-id]").attr("data-post-id"),b={vote:$(this).attr("data-vote")};$.ajax({url:"/api/post/"+a+"/vote",type:"POST",dataType:"json",data:b,success:function(a){$("#post_vote_num").text(a.votes);"1"==a.vote?($("#post_vote_c").hide(),$("#post_unvote_c").show()):($("#post_vote_c").show(),$("#post_unvote_c").hide())}})}
function onPostShowComments(){var a=$(this).parents("[data-post-id]").attr("data-post-id"),b=$(this).parents("[data-post-id]").attr("data-post-can-comment");$.ajax({url:"/api/post/"+a+"/comment",type:"GET",dataType:"json",success:function(a){a=a.comments;var d=$("#post_comment_list");d.empty();for(var e in a){e=a[e];var g=$("<li></li>");g.append('<img class="avatar-mini" src="'+e.author.avatar+'"></img>');g.append("<span>"+e.author.name+"</span>");g.append("<p>"+e.content+"</p>");d.append(g)}"true"==
b&&$("#comment_add").show();d.listview("refresh")}})}function onPostShowVotes(){var a=$(this).parents("[data-post-id]").attr("data-post-id");$.ajax({url:"/api/post/"+a+"/vote",type:"GET",dataType:"json",success:function(a){a=a.votes;var c=$("#vote_list");c.empty();for(var d in a){d=a[d];var e=$("<li></li>");e.append('<img class="avatar" src="'+d.author.avatar+'"></img>');e.append("<span>"+d.author.name+"</span>");c.append(e)}$("#popup-post-votes").popup("open",{transition:"fade"})}})}
function onPostCommentSubmit(){var a=$(this).parents("[data-post-id]").attr("data-post-id"),b={content:$("#comment_content").val()};0<b.content.length&&$.ajax({url:"/api/post/"+a+"/comment",type:"POST",dataType:"json",data:b,success:function(a){$("#comment_content").val("");a=a.comments;var b=$("#post_comment_list"),e;for(e in a){e=a[e];var g=$("<li></li>");g.append('<img class="avatar-mini" src="'+e.author.avatar+'"></img>');g.append("<span>"+e.author.name+"</span>");g.append("<p>"+e.content+"</p>");
b.append(g)}b.listview("refresh");$("#comment_content").val("")}})}
function loadPost(a){$.ajax({url:"/api/post/"+a,dataType:"json",success:function(a){var c=$("#page-post-detail");a=a.post;c.attr("data-post-id",a.id);c.attr("data-post-can-comment",a.cancomment);c.find("#post_author").text(a.author.name);c.find("#post_avatar").attr("src",a.author.avatar);c.find("#post_date").text(a.ext_date);c.find("#post_title").html(a.title);c.find("#post_content").html(a.content);c.find("#post_comment_num").text(a.comments);c.find("#post_vote_num").text(a.votes);c.find("#post_comment_list").empty();
var d=$('<ul class="unstyled"></ul>').empty(),e;for(e in a.resources){var g=a.resources[e];d.append($("<li></li>").append($("<a></a>").attr("href",g.url).text(g.desc)))}c.find("#post_resources").html(d);e=$('<ul class="unstyled"></ul>').empty();for(var f in a.attachments)d=a.attachments[f],d.imgthumb?e.append($("<li></li>").append($("<a></a>").attr("href",d.url).append($("<img></img>").attr("src",d.imgthumb)))):e.append($("<li></li>").append($("<a></a>").attr("href",d.url).text(d.desc)));c.find("#post_attachments").html(e);
isUserLogged()?(a.canadmin?$("#post_delete").show():$("#post_delete").hide(),a.cancomment&&0==a.comments?$("#comment_add").show():$("#comment_add").hide(),a.canvote?($("#post_vote_c").show(),$("#post_unvote_c").hide()):($("#post_vote_c").hide(),$("#post_unvote_c").show()),c.find("#post_commands").show()):(c.find("#comment_add").hide(),c.find("#post_commands").hide());$.mobile.changePage("#page-post-detail",{transition:"slide"})}})}
function onNodeClick(){var a=$(this).attr("data-node-id");$("#post_list").empty();loadNode(a);var b=$("#node");b.find("option").removeAttr("selected");b.find('option[value="'+a+'"]').attr("selected","true");b.selectmenu();$("#node-panel").panel("close")}function onUserClick(){var a=$(this).attr("data-user-id"),b=$("#user_to");b.find("option").removeAttr("selected");b.selectmenu("refresh");b.find('option[value="'+a+'"]').attr("selected","true");b.selectmenu("refresh")}
function onMessageSend(){var a=$("#user_to").val(),b=$("#message").val();0<b.length&&$.ajax({url:"/api/message/send",type:"POST",data:{user:a,message:b},dataType:"json",success:function(a){$("#message").val("")}})}
function onChannelMessage(a){a=jQuery.parseJSON(a.data);var b="";if("message"==a.type)b="<strong>"+a.user+"</strong>: "+a.body;else if("post"==a.type||"comment"==a.type)b=a.user+' ha aggiunto un <a href="'+a.source_uri+'">'+a.source_desc+'</a> su <a href="'+a.target_uri+'">'+a.target_desc+"</a>";$("#message_list").append($("<li></li>").append(b));$("#message_list").listview("refresh")}
function openChannel(a){channel=new goog.appengine.Channel(a);a=channel.open();a.onopen=function(){};a.onmessage=onChannelMessage;a.onerror=function(){};a.onclose=function(){};return a}
function loadNode(a,b){$("#post_list").attr("data-node-id",a);$("#load_more").on("click",function(){loadPostList($("#post_list").attr("data-node-id"),$("#post_list").attr("data-next-cursor"))});loadPostList(a);$("#form_post_new").ajaxForm({dataType:"json",success:function(a){a=a.post;$("#post_list").prepend(createPostItem(a));$("#post_list").listview("refresh");$.mobile.changePage("#page-stream")}})}
function loadPostList(a,b){b=b?b:"";$.mobile.showPageLoadingMsg();$.ajax({url:"/api/node/"+a+"/stream/"+b,dataType:"json",success:function(a){var b=$("#post_list"),e;for(e in a.posts)b.append(createPostItem(a.posts[e]));$("#post_list").attr("data-next-cursor",a.next_cursor);b.listview("refresh");$.mobile.hidePageLoadingMsg()}})}
function createPostItem(a){$('<li data-role="list-divider"><img src="'+a.author.avatar+'" alt="Autore" style="left:8px;top:8px;" class="ui-li-icon ui-corner-none"><span class="s_post_title">'+a.title.substring(0,20)+'</span><span class="ui-li-aside"><div class="s_post_node">'+a.node.name+'</div><div class="s_post_author"> di '+a.author.name+' </div><div class="s_post_date">'+a.ext_date+"</div></span></li>");var b=$("<li></li>"),c=$('<a href="#" class="s_post_item_a" data-transition="slide"></a>').attr("data-post-id",
a.id).on("click",function(){loadPost($(this).attr("data-post-id"))});c.append('<div><img src="'+a.author.avatar+'" alt="Autore" style="left:4px;top:4px;" class="avatar-mini ui-li-icon ui-corner-none"><span class="s_post_title">'+a.title.substring(0,60)+'</span></div><div><span class="s_post_node">'+a.node.name+'</span><span class="s_post_author"> di '+a.author.name+' </span><span class="ui-li-aside s_post_date">'+a.ext_date+"</div></span>");0<a.images.length&&c.append($('<img class="s_post_img_thumb"></img>').attr("src",
a.images[0]));c.append($('<div class="ui-li-desc s_post_content"></div>').append("<p>"+a.content_summary+"</p>"));b.append(c);return[b]}function getPrevBizDay(a){for(;5<a.getDay()||0==a.getDay();)a=new Date(a.getFullYear(),a.getMonth(),a.getDate()-1);return a}function getNextBizDay(a){for(;5<a.getDay()||0==a.getDay();)a=new Date(a.getFullYear(),a.getMonth(),a.getDate()+1);return a}function getDateFromStr(a){a=a.split("-");return new Date(a[0],a[1]-1,a[2])}
$(document).bind("pageloadfailed",function(a,b){a.preventDefault();window.location.href="/eauth/login?next="+b.absUrl;b.deferred.reject(b.absUrl,b.options)});
function initMenu(a,b,c){var d=$('<fieldset id="params" data-role="controlgroup" data-type="vertical"></fieldset>');isUserLogged()?d.append($('<select id="cm" name="school" data-mini="true" data-native-menu="false"/>')):(d.append($('<input id="cm" type="hidden" name="cm" value="'+a.schools[0].id+'"/>')),d.append($('<button data-mini="true">'+a.schools[0].name+"</button>").on("click",function(){loadSchoolList(function(){$.mobile.changePage("#page-school-chooser")})})));d.append($('<select id="data" name="cm" data-mini="true" data-native-menu="false"/>'));
var e=d.find("#cm"),g=d.find("#data");if(isUserLogged()){for(var f in a.schools)e.append($("<option>").attr("value",a.schools[f].id).text(a.schools[f].name));e.find("option[value='"+b+"']").attr("selected",1)}for(a=-7;7>=a;a++)b=new Date(c.getFullYear(),c.getMonth(),c.getDate()-a),6>b.getDay()&&0<b.getDay()&&(f=$("<option>"),b.getTime()==c.getTime()&&f.attr("selected",1),g.append(f.attr("value",b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()).text(b.toLocaleDateString("it"))));g.change(loadMenu);
e.change(loadMenu);$("#menu_form").html(d).trigger("create");loadMenu()}function onMenuDateChange(){var a=$("#data"),b=$("#cm"),a=getDateFromStr(a.val());initMenu(current_user,b.val(),a)}var menu={};
function loadMenu(){var a=$("#data").val(),b=$("#cm").val();getDateFromStr(a);getPrevBizDay(new Date);$.mobile.showPageLoadingMsg();$.ajax({url:"/api/menu/"+b+"/"+a,dataType:"json",success:function(a){menu=a;a=$("#menu_list").empty();for(var b in menu){var e=menu[b],g=$("<li></li>").attr("data-dish-id",e.id),e=$('<a class="dish_info" href=""></a>').text(e.desc1);g.append(e);a.append(g)}$("#menu_list").trigger("create");a.listview("refresh");$(".dish_info").on("click",onDishInfo);$.mobile.hidePageLoadingMsg()}})}
function onDishInfo(){var a=$(this).parents("li").attr("data-dish-id"),b=$("#cm").val(),c=getDish(a).desc1;$(".dish_name").text(c);$.ajax({url:"/api/dish/"+a+"/"+b,type:"GET",dataType:"json",success:function(b){$("#dish_components").empty();b=b.components;if(0<b.length)for(var c in b){var g=b[c],g=$("<tr></tr>").append("<td>"+g.name+"</td><td>"+g.qty+"</td>");$("#dish_components").append(g)}else g=$("<tr></tr>").append('<td colspan="2">Ingredienti non disponibili</td>'),$("#dish_components").append(g);
$("#page-dish-detail").attr("data-dish-id",a);c=$("#data");c=getDateFromStr(c.val());!isUserLogged()||c.getTime()>(new Date).getTime()?$("#dish_vote_c").hide():$("#dish_vote_c").show();$.mobile.changePage("#page-dish-detail",{transition:"slide"})}})}
function onDishStat(){var a=$(this).parents("[data-dish-id]").attr("data-dish-id");getDish(a);getVotesAvg(a,function(){var b=createVoteMap(a);vote_avg[a].avgS["id-0"]?(createVoteChart(a,b,"dish_stat_graph"),createVoteTable(a,b,"dish_stat_table"),$.mobile.changePage("#page-dish-stat",{transition:"flip"})):alert("Statistiche non disponibili per questo piatto.")})}
function onDishVote(){var a=$(this).parents("[data-dish-id]").attr("data-dish-id"),b=getDish(a).desc1;$.mobile.changePage("#page-dish-vote",{transition:"flip"});createWidget(current_user.id,a,b)}function onMenuStat(){var a=[],b=[];$("#menu_list").find("[data-dish-id]").each(function(c,d){var e=$(d).attr("data-dish-id");a.push(e);b.push(getDish(e).desc1)});showMenuStat(a,b)}
function onMenuVote(){var a=[],b=[];$("#menu_list").find("[data-dish-id]").each(function(c,d){var e=$(d).attr("data-dish-id");a.push(e);b.push(getDish(e).desc1)});$.mobile.changePage("#page-dish-vote",{transition:"flip"});createWidgetMenu(current_user.id,0,a,b)}
var context={apiKey:"apk-f7adfcbc-7279-3107-15d0-cbf4bca01496",group:"group-vsite",lang:"it",enviroment:"production",custom_button:"http://www.pappa-mi.it/img/pappa-mi-logo.png"},veespo_api_const={category:"ctg-f86fbf9e-b53b-e7a5-d75d-57139ea6541d",api_tag_list:"http://legacy1.veespo.com/v1/tag-frequency/category/ctg-f86fbf9e-b53b-e7a5-d75d-57139ea6541d?lang=it",api_vote_avg:"http://legacy1.veespo.com/v1/average/target/",api_last_vote:"http://legacy1.veespo.com/v1/ratings/user/:user_id/target/:target_id"},
tag_map,vote_avg={};function getVotesAvg(a,b){$.getJSON(veespo_api_const.api_vote_avg+"tgt-pappa-mi-dish-"+a+"?callback=?").then(function(c){vote_avg[a]=c.data;b()})}function getVotesTag(){$.getJSON(veespo_api_const.api_tag_list+"&callback=?").then(function(a){tag_map=a.data;tag_map["id-0"]={freq:0,label:"Complessivo"}})}
function getLastVote(a,b,c){a=veespo_api_const.api_last_vote.replace(":user_id","pappa-mi-user-"+a).replace(":target_id","tgt-pappa-mi-dish-"+b);$.getJSON(a+"?callback=?").then(function(a){a=a.data;c&&c(a)})}
function createWidget(a,b,c){context.title=c;context.targetId="tgt-pappa-mi-dish-"+b;context.userId="pappa-mi-user-"+current_user.id;$("#widget_vote").veespo("widget.inject-to-dom",{context:context}).then(function(a){getLastVote(current_user.id,b,function(a){getVotesAvg(b,function(){var c=createVoteMap(b,a);createVoteChart(b,c,"dish_stat_graph");createVoteTable(b,c,"dish_stat_table");$.mobile.changePage("#page-dish-stat",{transition:"flip"})})})})}
function createWidgetMenu(a,b,c,d){var e=c[b];context.title=d[b];context.targetId="tgt-pappa-mi-dish-"+e;context.userId="pappa-mi-user-"+current_user.id;$("#widget_vote").veespo("widget.inject-to-dom",{context:context}).then(function(e){b++;b<c.length?createWidgetMenu(a,b,c,d):showMenuStat(c,d)})}
function showMenuStat(a,b){$("#dish_name_0").text(b[0]);getLastVote(current_user.id,a[0],function(b){getVotesAvg(a[0],function(){var d=createVoteMap(a[0],b);createVoteChart(a[0],d,"dish_stat_graph_0");createVoteTable(a[0],d,"dish_stat_table_0")})});$("#dish_name_1").text(b[1]);getLastVote(current_user.id,a[1],function(b){getVotesAvg(a[1],function(){var d=createVoteMap(a[1],b);createVoteChart(a[1],d,"dish_stat_graph_1");createVoteTable(a[1],d,"dish_stat_table_1")})});$("#dish_name_2").text(b[2]);getLastVote(current_user.id,
a[2],function(b){getVotesAvg(a[2],function(){var d=createVoteMap(a[2],b);createVoteChart(a[2],d,"dish_stat_graph_2");createVoteTable(a[2],d,"dish_stat_table_2")})});$("#dish_name_3").text(b[3]);getLastVote(current_user.id,a[3],function(b){getVotesAvg(a[3],function(){var d=createVoteMap(a[3],b);createVoteChart(a[3],d,"dish_stat_graph_3");createVoteTable(a[3],d,"dish_stat_table_3")})});$.mobile.changePage("#page-menu-stat",{transition:"flip"})}
function createVoteMap(a,b){var c={},d=vote_avg[a].avgS,e;for(e in d)tag_map[e]&&(c[e]={label:tag_map[e].label,avg:d[e],rating:""});if(b)for(e in b)e=b[e],c[e.tag]&&(c[e.tag].rating=e.rating);return c}var charts={};
function createVoteChart(a,b,c){a=charts[c];a||(a=new Chart(document.getElementById(c).getContext("2d")),charts[c]=a);c={labels:[],datasets:[]};c.datasets[0]={fillColor:"rgba(127,255,127,0.5)",strokeColor:"rgba(127,255,127,1)",pointColor:"rgba(0,255,0,1)",pointStrokeColor:"#fff",data:[]};b["id-0"]&&""!=b["id-0"].rating&&(c.datasets[1]={fillColor:"rgba(127,127,255,0.5)",strokeColor:"rgba(127,127,255,1)",pointColor:"rgba(0,0,255,1)",pointStrokeColor:"#fff",data:[]});for(var d in b)d=b[d],c.labels.push(d.label),
c.datasets[0].data.push(d.avg),b["id-0"]&&b["id-0"].rating&&c.datasets[1].data.push(d.rating);a.Radar(c,{scaleShowLabels:!1,pointLabelFontSize:10})}
function createVoteTable(a,b,c){var d=$("#"+c).find("thead");d.empty();a=$("<tr></tr>");a.append("<td>Caratteristica</td>");a.append('<td><span style="color:rgb(0,255,0);">Media</span></td>');b["id-0"]&&""!=b["id-0"].rating&&a.append('<td><span style="color:rgb(0,0,255);">Mio voto</span></td>');d.append(a);c=$("#"+c).find("tbody");c.empty();for(var e in b)e=b[e],a=$("<tr></tr>"),a.append("<td>"+e.label+"</td>"),a.append("<td>"+Math.round(100*e.avg)/100+"</td>"),""!=b["id-0"].rating&&a.append("<td>"+
Math.round(100*e.rating)/100+"</td>"),c.append(a)}function getDish(a){for(var b in menu)if(menu[b].id==a)return menu[b];throw Error("Failed to find dish: "+a);};