<script type="text/javascript">

function onOpenPostForm(){
$("#new_post_form").slideDown()
$("#open_post_button").hide()
}
function onOpenPostFormCancel(){
$("#new_post_form").slideUp()
$("#open_post_button").show()
}
</script>
<h2>Dettaglio Nodo</h2>
<div id="node_name">{{node.name}}</div>

{%if user%}
<div class="well" style="padding: 10px;">
 <div class="btn-toolbar">
  <div id="subscribe_btn" style="{% if not show_sub_button %}display:none {% endif%}" class="btn" onclick="onSubscription({{user.key.id()}},{{node.key.id()}})">Iscriviti</div>
  <div id="unsubscribe_btn" style="{% if not is_sub %}display:none {% endif%}" class="btn" onclick="onUnsubscription({{user.key.id()}},{{node.key.id()}})">Discriviti</div>
  <div id="subscribed_users">Utenti iscritti{% for i in subscriptions %}{% if i!=[] %}<div>{{i.nome}}</div>{% endif %}{% endfor %}</div>
 </div>
</div>
{%endif%}
<div id="node_posts span8"> 
	<ul class="thumbnails">
	{% for post in latest_posts %}
		<li>
			<div class="social_post, thumbnail"> 
				<div class="s_post_avatar">
					<img class="avatar" src="{{post.commissario.avatar(cmsro)}}" title="{{post.commissario.nomecompleto(cmsro)}}">
				</div>
				<div class="s_post_content">
					<div class="s_post_header">			
						<div class="s_post_title"><a href="/social/post/{{post.key.urlsafe()}}">{{post.title}}</a></div> 
						<div class="s_post_author">scritto da {{post.commissario.nome}}</div>
						<div class="s_post_date">&nbsp;- il {{post.creation_date.strftime('%d %m %Y')}}</div>
					</div>				
					<div class="s_post_body">{{post.content}}</div>									
					<div class="s_post_commands">
						{%if subscription.can_admin%}<button class="btn btn-danger" onClick="onPostDelete('{{user.key.urlsafe()}}','{{node.key.urlsafe()}}','{{post.key.urlsafe()}}')"><i class="icon-remove"></i>Elimina</button>{%endif%}
					</div>			
				</div>				
			</div>
		</li>	
	{% endfor%}
	</ul>
</div>
	
{%if user and subscription.can_post%}	
<div id="open_post_button" class="btn btn-primary" type="submit" onclick="onOpenPostForm()">Inizia Nuova Discussione</div>
<form id="new_post_form" style="display:none">
	<div id="post_title" class="form_parent">
		<label id="post_content_label" for="titolo">Titolo</label>
		<input class="span8 comment_textarea required" name="titolo" id="post_title_text"></input>
	</div>
	<div id="post_content" class="form_parent">
		<label id="post_content_label" for="content">Contenuto</label>
		<input class="span8 comment_textarea required" name="content" id="post_content_text"></input>
	</div>
	<div class="form-actions">
		<div id="open_post_submit" class="btn btn-primary" type="submit" onclick="onOpenPostSubmitted('{{user.key.urlsafe()}}','{{node.key.urlsafe()}}')" data-loading-text="Invio risposta in corso..."/>Invia</div>	
		<div id="open_post_cancel_button" class="btn btn-primary" type="submit" onclick="onOpenPostFormCancel()">Annulla</div>
	</div>
</form>  
{%endif%}
