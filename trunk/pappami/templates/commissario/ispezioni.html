<script type="text/javascript">
dojo.require("dijit.form.Form");
dojo.require("dijit.form.ComboBox");
dojo.require("dijit.form.Button");
dojo.require("dijit.Dialog");
dojo.require("dijit.Tooltip");
dojo.require("dijit.form.FilteringSelect");
dojo.require("dojo.data.ItemFileReadStore");
dojo.require("dojo.parser");
</script>
<script src="/js/form.js" type="text/javascript"></script>
<script src="/js/gviz.js" type="text/javascript"></script>
<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script>
    google.load('visualization', '1', {'packages' : ['table']});
    dojo.addOnLoad(init);    

    var query, options, container, whereClause;
    var display = "";
    
    function init() {
      var cmStore = new dojo.data.ItemFileReadStore({url: "/commissario/getcm"});
      query = new google.visualization.Query('/commissario/getdata');
      container = document.getElementById("ispezioni");
      options = {'pageSize': 10, 
                 'callPre': function() {dojo.byId("d_loading").style.display = "inline";},
                 'callPost': function() {dojo.byId("d_loading").style.display = "none";},
                 'sortableColumns': 'commissione data'
                 };
      var me = dojo.byId("e_me");
      var cm = dijit.byId("e_cm");
      var anno = dojo.byId("e_aa");
      cookie = readCookie("pappa-mi-ctx");
      if(cookie) {
        var p = cookie.split(",");
        me.checked = (p[0] == "true");
        cm.attr("value", p[1]);
        anno.value=p[2];
        whereClause = "from isp" + " me " + ((p[0] == "true")?"on":"") + " commissione " + p[1] + " anno " + p[2];
      }
      display="none";
      sendAndDraw();        
      display="inline";
    }

    function sendAndDraw() {
      query.abort();
      var tableQueryWrapper = new TableQueryWrapper(query, container, options);
      tableQueryWrapper.setWhereQueryClause(whereClause);
      dojo.byId("d_loading").style.display = display;
      tableQueryWrapper.sendAndDraw();
    } 

    function setQuery() {
        var me = dojo.byId("e_me");
        var cm = dijit.byId("e_cm");
        var anno = dojo.byId("e_aa");
        whereClause = "from isp" + " me " + (me.checked?"on":"") + " commissione " + cm.value + " anno " + anno.value;
        createCookie("pappa-mi-ctx", me.checked + "," + cm.attr("value") + "," + anno.value, 10);
        sendAndDraw();        
    } 
</script>
<H1 class="ss-form-title">Elenco Schede Ispezione</H1>
<div dojoType="dijit.form.DropDownButton">
<span>Filtra dati</span>
<div dojoType="dijit.TooltipDialog" id="tooltipDlg" title="Filtro dati"
    execute="setQuery();">
<!--form dojoType="dijit.form.Form" action="/commissario" method="get" id="form0"-->
<table>
<tr>
<td>
<LABEL class="ss-q-title" for="e_me">Inserite da me</LABEL>
<input type="CHECKBOX" name="me" value="on" id="e_me"></input></td>
</tr>
<tr>
<td>
<div dojoType="dojo.data.ItemFileReadStore" jsId="cmStore" url="/commissario/getcm">
<LABEL class="ss-q-title" for="e_cm">Commissioni</LABEL>
<input dojoType="dijit.form.FilteringSelect" value="" store="cmStore"
searchAttr="nome" name="cm" id="e_cm">
</td>
</tr>
<tr>
<td>
<LABEL class="ss-q-title" for="e_aa">Anno scolastico</LABEL>
<SELECT name="anno" id="e_aa">
<OPTION value="">Tutti</OPTION>
<OPTION value="2008">2008-2009</OPTION>
<OPTION value="2009">2009-2010</OPTION>
</select>
</td>
</tr>
<tr>
<td>
<button dojoType="dijit.form.Button" type="submit">Applica</button>
</td>
</tr>
</table>
<!--/form-->
</div>
</div>
<div dojoType="dijit.form.DropDownButton">
<span>Legenda</span>
<div dojoType="dijit.TooltipDialog" id="legendDlg" title="Legenda">
<table>
<tr>
<td>
<b>Assaggio</b><br>
<img src="img/icoasg1.png"> Non Accettabile<br>
<img src="img/icoasg2.png"> Normale<br>
<img src="img/icoasg3.png"> Gradevole
</td>
<td>
<b>Gradimento</b><br>
<img src="img/icogra1.png"> Rifiutato<br>
<img src="img/icogra2.png"> Parzialmente rifiutato<br>
<img src="img/icogra3.png"> Parzialmente accettato<br>
<img src="img/icogra4.png"> Accettato
</td>
<td>
<b>Cottura</b><br>
<img src="img/icocot1.png"> Scarsa<br>
<img src="img/icocot2.png"> Giusta<br>
<img src="img/icocot3.png"> Eccessiva
</td>
<td>
<b>Temperatura</b><br>
<img src="img/icotmp1.png"> Freddo<br>
<img src="img/icotmp2.png"> Giusta<br>
<img src="img/icotmp3.png"> Caldo
</td>
<td>
<b>Quantit&agrave;</b><br>
<img src="img/icoqta1.png"> Scarso<br>
<img src="img/icoqta2.png"> Sufficiente<br>
<img src="img/icoqta3.png"> Abbondante
</td>
<td>
<b>Maturazione</b><br>
<img src="img/icomat1.png"> Acerba<br>
<img src="img/icomat2.png"> Giusta<br>
<img src="img/icomat3.png"> Matura
</td>
</tr>
</table>
</div>
</div>
<div id="ispezioni"></div>
<div class="goog-ws-half-width goog-ws-left">
<A id="test-list-page-add-button" href="/commissario/ispezione" class="btn"><B><B><B><B style="font-weight:bold !important;">Aggiungi Ispezione</B></B></B></B></A>
</div>
<div id="d_loading" style="display:none; opacity:0.9; text-align: center; border-style:solid; border-width:1px; background-color: white; width: 300px; height: 60px; position:absolute; top: 160px; left: 400px;"><br><img src="/img/loading.gif" style = "margin:auto;" alt="loading"/></div>
