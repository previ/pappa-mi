{% set providers = [
  ('google', '/auth/google'),
  ('facebook', '/auth/facebook'),
  ('twitter', '/auth/twitter'),
  ('yahoo', '/auth/appengine_openid?provider=yahoo.com'),
  ('linkedin', '/auth/linkedin'),
  ('windowslive', '/auth/windowslive'),
  ('password', '/eauth/signup'),
] -%}

<script src="/js/profilo.js" type="text/javascript"></script>
<div class="row">
  <div class="span12">
    <h2><img src="{{user.avatar}}" class="avatar"> <span>{{user.fullname}}</span></h2>
  </div>
</div>
<form action="/profilo" method="POST" id="form0" novalidate class="form-horizontal">
<div class="row">
  <div class="span12">
    <ul class="nav nav-tabs">
      <li class="active"><a href="#profile" data-toggle="tab">Profilo</a></li>
      <li><a href="#auth" data-toggle="tab">Account e Password</a></li>
      <li><a href="#notifications" data-toggle="tab">Notifiche</a></li>
    </ul>
    <div class="tab-content">
      <div id="profile" class="tab-pane active">
	<fieldset>
	<legend>I tuoi dati</legend>
	<div class="control-group">
	  <label for="avatar">Email</label>
	  <div class="controls"><input class="xlarge required email" id="email" name="email" value="{{cmsro.usera.get().email}}" size="30" type="text" readonly></div>
	</div>
	<div class="control-group">
	  <label for="avatar">Immagine</label>
	  <div class="controls"><img id="avatar" src="{{cmsro.avatar()}}" class="avatar-big"/></div>
	</div>
	<div class="control-group">
	  <label for="nome">Nome</label>
	  <div class="controls"><input class="xlarge required" id="nome" name="nome" value="{{cmsro.nome}}" size="30" type="text"></div>
	</div>
	<div class="control-group">
	  <label for="cognome">Cognome</label>
	  <div class="controls"><input class="xlarge required" id="cognome" name="cognome" value="{{cmsro.cognome}}" size="30" type="text"></div>
	</div>
	<div class="control-group">
	  <label for="citta">Citt&agrave;</label>
	  <div class="controls">
	    <select class="xlarge required" id="citta" name="citta" value="">
	    <option value=""></option>
	    {%for cit in citta%}<option value="{{cit.key.id()}}"{%if cit.key.id() == cmsro.citta.id()%} selected{%endif%}>{{cit.nome}}</option>{%endfor%}
	    </select>
	  </div>
	</div>
	<div class="control-group">
	  <label for="commissione_sel"></label>
	  <div class="controls"><input id="tipo_cm" name="tipo" value="0" class="required" type="radio"{%if cmsro.isCommissario()%} checked{%endif%}{%if cmsro.isRegCommissario()%} checked{%endif%} disabled> Faccio parte di una Commissione mensa</input></div>
	  <div class="controls"><input id="tipo_g" name="tipo" value="11" class="required" type="radio"{%if cmsro.isGenitore()%} checked{%endif%} disabled> Sono una mamma o un pap&agrave;</input></div>
	</div>
	<div class="control-group">
	  <label for="commissione_sel">Seleziona una o pi&ugrave; scuole</label>
	  <div class="controls"><input class="xlarge" id="commissione_sel" name="commissione_sel"/>
	  </div>
	</div>
	<div class="control-group">
	  <div class="controls" id="commissioni">{%for cm in cmsro.commissioni()%}<div class="list-item input-xlarge"><input type="hidden" id="commissione" name="commissione" value="{{cm.key.id()}}"/><a class="close" href="#" onclick="$(this).parent('div').remove();">&times;</a><p><b>{{cm.desc()}}</b></p></div>{%endfor%}
	  </div>
	</div>
	</fieldset>
      </div>
      <div id="auth" class="tab-pane">
	<fieldset>
	<legend>Account collegati</legend>	
      {% for p, u in providers %}
	<div class="control-group">    
	  <label for="{{ p }}"><img src="/img/eauth/{{ p }}.png"/></label>
	  <div class="controls">   
	   <div class="radio-group btngroup">
	    <label class="btn{%if user.has_auth_strategy(p) %} active{%endif%}"><input type="radio" name="{{ p }}" value="1" onclick="location.href='{{ u }}'" class="required" id="e_{{ p }}_1"/>Attivato</label>
	    <label class="btn{%if not user.has_auth_strategy(p) %} active{%endif%}"><input type="radio" name="{{ p }}" value="0" class="required" id="e_{{ p }}_1"/>Disattivato</label>	  
	   </div>
	    {%if p == 'password'%}<button class="btn" onclick="location.href='/eauth/pwdchg'">Cambio password</button>{%endif%}
	  </div>	
        </div>	
      {% endfor %}
	<legend>Password</legend>	
	<div class="control-group">
	  <div class="controls">
	    <label for="email">Email</label>
	    <input id="email" name="email" value="" type="text" class="span3 email"/>
	    <label for="password">Password</label>	  
	    <input id="password" name="password" value="" type="password" class="span3 password"/>
	    <label for="password2">Ripeti Password</label>
	    <input id="password2" name="password" value="" type="password" class="span3 password"/>
	  </div>
	</div>
	</fieldset>
      </div>
      <div id="notifications" class="tab-pane">
	<fieldset>
	<legend>Avvisami via mail in caso di:</legend>
	<div class="control-group">    
	  <div class="controls"><input id="nome" name="nome" value="" type="checkbox"> Novit&agrave; sulla mia Scuola</input></div>
	</div>
	<div class="control-group">
	  <div class="controls"><input id="nome" name="nome" value="" type="checkbox"> Novit&agrave; sulla mia Citt&agrave;</input></div>
	</div>
	<div class="control-group">
	  <div class="controls"><input id="nome" name="nome" value="" type="checkbox"> Tutte le novit&agrave;</div>
	</div>
	</fieldset>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="span12">
    <div class="form-actions">
      <input type="submit" class="btn btn-primary" value="Salva">&nbsp;<button type="reset" class="btn">Annulla</button>
    </div>
  </div>
</div>
<div id="message" class="span12" style="display:none;">
<div class="alert alert-info fade in" data-alert="alert">
  <a class="close" href="#">&times;</a>
  <p id="message_body"></p>
  <div class="alert-actions">
    <a class="btn" href="#" onclick="window.location.href='/'">Procedi</a>
  </div>
</div>
</form>
<div id="dialog" style="display:none;"></div>
{%include "avatar.html"%}