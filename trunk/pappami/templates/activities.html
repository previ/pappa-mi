<script type="text/javascript"> 

var query = "";
var offset = 1;

// wait for the DOM to be loaded 
$(document).ready(function() { 
  $('#activity_list').load('/comments/load', function(){
    $('#e_act_more').bind( "click", function(){moreactivities();} );
    $('#act_loading').hide();      
    $("#nav-sec").children().removeClass("active");
    $("#cm{{ctx.cm}}type{{ctx.type}}user{{ctx.user}}tag{{ctx.tag}}").addClass("active");    
  });        
  $('#allegato_file_1').change(function(){
   $('#allegato_file_2').show(); 
  });
  $('#allegato_file_2').change(function(){
   $('#allegato_file_3').show();
  });
  $('#citta').change( oncitychanged);
  oncitychanged();    
}); 
</script> 
{%set tab_activity="active"%}
{%include "navigation.html"%}
<div id="activities" class="activity_container">
 <div id="nav-priv-cnt"></div>
 <div id="new-data" style="display:none;">
  <div id="new-data-form" style="border: none;"></div> 
  <div id="new-data-preview" style="display:none;"></div> 
 </div> 
 <div id="new-nc" style="display:none;"></div>
 <div class="row">
  <div class="span3">
   <ul class="nav nav-list well" id="nav-sec">
    <li class="nav-header"><i class="icon-home"></i>Scuole</li>
    {%if commissario or genitore%}{%for cm in cmsro.commissioni() %}<li id="cm{{cm.key.id()}}typeusertag"><a href="#" onclick="filteractivities('cm={{cm.key.id()}}&type=&user=&tag=');">{{cm.desc()}}</a></li>
    {%endfor%}{%endif%}
    <li class="dropdown">
     <a id="dropdown" class="dropdown-toggle dropdown-form" data-toggle="dropdown" href="#">
      Scegli...<b class="caret"></b>
     </a>
     <ul class="dropdown-menu dropdown-large">
	<label for="citta">Citt&agrave;</label>
	<select class="large required" id="citta" name="citta">
	{%for cit in citta%}<option value="{{cit.key.id()}}"{%if ctx.citta_key and cit.key.id() == ctx.citta_key%} selected{%endif%}>{{cit.nome}}</option>{%endfor%}
	</select>
	<label for="commissione_sel">Scuola (Commissione Mensa)</label>
	<div class="input"><input class="" id="commissione_sel" name="commissione_sel"/>
	<input type="hidden" id="cm" name="cm"/>
	</div>
	<div class="controls">
	  <button type="submit" class="btn primary" onclick="filtercm();">Ok</button>
	  <button type="reset" class="btn" onclick="$('#dropdown').click();">Annulla</button>
	</div>
     </ul>
    </li>
    <li class="nav-header"><i class="icon-file"></i>Tipo dati</li>
    <li id="cmtypeusertag"><a href="#" onclick="filteractivities('cm=&type&user=&tag=')">Tutto</a></li>
    <li class="divider"></li>{%if commissario or genitore%}
    <li id="user{{user.get_id()}}typetagcm"><a href="#" {%if ctx.user == user.get_id()%}class="active"{%endif%} onclick="filteractivities('user={{user.get_id()}}&type=&tag=&cm=')">Inseriti da me</a></li>
    <li class="divider"></li>{%endif%}
    <li id="cmtype201usertag"><a href="#" onclick="filteractivities('cm=&type=201&user=&tag=')">Messaggi</a></li>
    <li id="cmtype101usertag"><a href="#" onclick="filteractivities('cm=&type=101&user=&tag=')">Ispezioni</a></li>
    <li id="cmtype103usertag"><a href="#" onclick="filteractivities('cm=&type=103&user=&tag=')">Ispezioni Diete</a></li>
    <li id="cmtype102usertag"><a href="#"  onclick="filteractivities('cm=&type=102&user=&tag=')">Non conformit&agrave;</a></li>
    <li id="cmtype104usertag"><a href="#" onclick="filteractivities('cm=&type=104&user=&tag=')">Note</a></li>    
    <li class="nav-header"><i class="icon-tags"></i>Categorie</li>
    {%for tag in tags%}<li id="cmtypeusertag{{tag.nome}}"><a href="#" onclick="filteractivities('cm=&type=&user=&tag={{tag.nome}}')">{{tag.nome}}</a></li>
    {%endfor%}
   </ul>    
  </div>  
  <div class="span9">
 {%if commissario or genitore%}
   <div class="well" style="padding: 10px;"><h4><small>Aggiungi nuovo</small></h4>
    <div class="btn-toolbar">
     <button class="btn btn-primary" onclick="opennewmsg();">Messaggio</button>
     {%if commissario%}
     <button class="btn btn-primary" onclick="opennewisp();">Ispezione</button>
     <button class="btn btn-primary" onclick="opennewdieta();">Ispezione Diete</button>
     <button class="btn btn-primary" onclick="opennewnc();">Non conformit&agrave;</button>
    {%endif%}
     <button class="btn btn-primary" onclick="opennewnota();">Nota</button>
    </div>
   </div>
   <div id="new-msg" style="display:none;">
    <form id="new-msg-form" action="/comments/message" method="post" class="form-stacked" novalidate="true"> 
     <input type="hidden" id="act_last" name="last" value="" />  
     <input type="hidden" name="livello" value="0" />  
     <input type="hidden" name="tipo" value="201" /> 
     <div class="comment_avatar">
      <img class="avatar" src="{{cmsro.avatar(cmsro)}}" title="{{cmsro.nomecompleto(cmsro)}}">
     </div>
     <div class="comment_body">
      <div class="comment_author">{{cmsro.nomecompleto(cmsro)}}</div>
      <div class="comment_author_title">{{cmsro.titolo(cmsro)}}</div>       
      <div class="comment_text">
       <div class="controls">
	<label>Titolo:</label>
	<div class="control-group">
	 <input type="text" class="span8 required" name="titolo">
	</div>
	<label class="control-label">Testo:</label>
	<div class="control-group" id="e_message_container">
	 <textarea cols="80" rows="4" class="span8 comment_textarea required" name="testo" id="e_message"></textarea>
	</div>
	<div class="control-group">       
	 <label class="control-label" for="e_attach">Allegati</label>
	 <input type="file" name="allegato_file_1" id="allegato_file_1" allow="image/jpeg, image/png, image/gif, image/tiff, application/pdf, application/msword, application/x-excel"/>
	 <input type="file" name="allegato_file_2" id="allegato_file_2" style="display:none;" allow="image/jpeg, image/png, image/gif, image/tiff, application/pdf, application/msword, application/x-excel"/>
	 <input type="file" name="allegato_file_3" id="allegato_file_3" style="display:none;" allow="image/jpeg, image/png, image/gif, image/tiff, application/pdf, application/msword, application/x-excel"/>
	</div>
	<label class="control-label">Categorie:</label>	 
	<div class="control-group">  	  
	 <ul id="message_tags_handler"></ul>
	</div>
       </div>
       <div class="actions">
	<button class="btn btn-primary" type="submit">Invia</button>
	<button class="btn" type="reset" onclick="opennewmsg();">Annulla</button>
       </div>
      </div>  
     </div>  
    </form>
   </div>
  {%endif%}
   <div id="act_loading" style="text-align:center;">Loading...</div>
   <ul class="activity_list" id="activity_list"></ul>
   <div class="span6 offset1"><button data-loading-text="caricamento in corso..." class="btn span6" id="e_act_more">Carica altri...</button></div>    
  </div>
 </div>
</div>
