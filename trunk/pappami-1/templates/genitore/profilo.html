<script type="text/javascript">
dojo.require("dijit.form.Form");
dojo.require("dijit.form.TextBox");
dojo.require("dijit.form.Button");
dojo.require("dijit.Tooltip");
dojo.require("dijit.form.FilteringSelect");
dojo.require("dojo.data.ItemFileReadStore");
dojo.require("dojo.parser");
</script>
<script>
function alreadySelected() {
    cm_all = dijit.byId("e_cm_all");
    cm_sel = dojo.byId("e_cm_sel");
    for( i=0;i<cm_sel.options.length;i++) {
        if(cm_all.attr("value") == cm_sel.options[i].value ) {
            alert(cm_all.innerHTML + " gia' aggiunta");
            return true;
        }
    }
    return false;
}

function onSelComm() {
    cm_all = dijit.byId("e_cm_all");
    cm_sel = dojo.byId("e_cm_sel");

    if(cm_all.attr("value") != "" && !alreadySelected()) {
        var oOption = document.createElement('OPTION');
        try {
            cm_sel.add(oOption, null);
        } catch(ex) {
            cm_sel.add(oOption);
        }        
        oOption.innerHTML = cm_all.attr('displayedValue');
        oOption.value = cm_all.attr("value");
    }
}
function onRem() {
    cm_all = dojo.byId("e_cm_all");
    cm_sel = dojo.byId("e_cm_sel");
    if(cm_sel.selectedIndex >= 0) {
        cm_sel.remove(cm_sel.selectedIndex);
    }
}

function removeAll() {
    cm_all = dojo.byId("e_cm_all");
    cm_sel = dojo.byId("e_cm_sel");
    while(cm_sel.options.length) {
        cm_sel.remove(cm_sel.options.length-1);
    }
}
</script>
<H1>I tuoi dati</H1>
<P>
<P>
<!--span class="ss-required-asterisk">* Campo obbligatorio</span-->
<BR>
<FORM dojoType="dijit.form.Form" action="/genitore/profilo" method="POST" id="form_0">
<script type="dojo/method" event="onSubmit">
cm_sel = dojo.byId("e_cm_sel");
for(var i=0;i<cm_sel.options.length;i++) cm_sel.options[i].selected = true;
if(this.validate())/*&&
dojo.byId("e_n").value != "" &&
dojo.byId("e_c").value != "" &&
dojo.byId("e_cm_sel").options.length != ""){
    dojo.byId("e_submit").disabled = true;
    dojo.byId("e_annulla").disabled = true;
    return true;
} else {
    alert('Inserire tutti i dati richiesti: Nome e Cognome e almeno una Scuola');
    return false;
}*/
return true;
</script>
<table width="100%">
<tr>
<td>
<div class="errorbox-good">
<div class="ss-form-entry"><label class="ss-q-title" for="e_n">Nome
<span class="ss-required-asterisk"></span></label>
<label class="ss-q-help" for="e_n"></label>
<input type="text" dojoType="dijit.form.TextBox" required="false" style="width:20em;" name="nome" value="{{cmsro.nome}}" class="ss-q-short" id="e_n"></div></div>
</td>
<td>
<div class="errorbox-good">
<div class="ss-form-entry"><label class="ss-q-title" for="e_c">Cognome
<span class="ss-required-asterisk"></span></label>
<label class="ss-q-help" for="e_c"></label>
<input type="text" dojoType="dijit.form.TextBox" required="false" style="width:20em;" name="cognome" value="{{cmsro.cognome}}" class="ss-q-short" id="e_c"></div></div>
</td>
</tr>
<tr>
<td>
<div dojoType="dojo.data.ItemFileReadStore" jsId="cmStore" url="/genitore/getcm">
<div class="errorbox-good">
<div class="ss-form-entry" id="l_cm"><label class="ss-q-title" for="e_cm">Scuola
<span class="ss-required-asterisk"></span></label>
<table><tr><td>
<input dojoType="dijit.form.FilteringSelect" value="{{cmsro.nome}}" store="cmStore"
searchAttr="nome" name="commissione_all" id="e_cm_all" style="width:24em;" onchange="onSelComm();">
<br/><br/>
<SELECT name="commissione" id="e_cm_sel" multiple="yes" style="width:24em; height:6em;" ondblclick="onRem();">
{%if cmsro%}
{%for cm in cmsro.commissioni%}
<option value="{{cm.key}}">{{cm.nome}} - {{cm.tipoScuola}}</option>
{%endfor%}
{%endif%}
</SELECT><span dojoType="dijit.Tooltip" connectId="l_cm" position="above" style="display:none;" id="tt_cm"> 
Aggiungere una o pi&ugrave Scuole per cui si desidera registrarsi.<br/><br/>
<ul>
<li>Selezionare una Scuola dalla lista per aggiungerlo all'elenco, ripetere l'operazione per tutte le Scuole desiderate</li>
<li>Fare doppio clic su una Scuola per eliminarla dall'elenco in caso di errore</li>
</ul></span> 
</td></tr></table>
</div></div>
</td>
<td><input name="emailalert" {%if cmsro.emailComunicazioni%}checked{%endif%} type="checkbox">Avvisami via mail se ci sono novit&agrave;</input></td>
</tr>
{%if saved%}<tr>
<td align="center" colspan="2">
I dati sono stati salvati.
</td></tr>{%endif%}
<tr>
<td align="center" colspan="2">
<button type="submit" id="e_submit">Salva</button><button onclick="location.href='/';return false;" id="e_annulla">Annulla</button>
</td>
</tr>
</table></FORM>