var channel="";$(document).ready(function(){var a=$("body").attr("data-channel-id");""==channel&&""!=a&&(channel=openChannel(a));""!=a&&getNotificationsNum()});function openChannel(a){channel=new goog.appengine.Channel(a);a=channel.open();a.onopen=function(){};a.onmessage=onChannelMessage;a.onerror=function(){};a.onclose=function(){};return a}
function getNotificationsNum(){$.ajax({type:"POST",url:"/ntfctn",data:{cmd:"get_num"},dataType:"json",success:function(a){$(".s_glob_ntfy").text(a.ntfy_num);0<parseInt(a.ntfy_num)&&!$(".s_glob_ntfy").hasClass("badge-warning")?$(".s_glob_ntfy").addClass("badge-warning"):0==parseInt(a.ntfy_num)&&$(".s_glob_ntfy").hasClass("badge-warning")&&$(".s_glob_ntfy").removeClass("badge-warning")}})}
function onChannelMessage(a){a=jQuery.parseJSON(a.data);var b="";if("message"==a.type)b="<strong>"+a.user+"</strong>: "+a.body;else if("post"==a.type||"comment"==a.type)getNotificationsNum(),b=a.user+' ha aggiunto un <a href="'+a.source_uri+'">'+a.source_desc+'</a> su <a href="'+a.target_uri+'">'+a.target_desc+"</a>";$.pnotify({title:"Notifica",text:b})}
var tiny_mce_opts={width:"100%",autoresize_min_height:100,theme:"modern",plugins:"autolink,autoresize,link,image,media",menubar:!1,statusbar:!1,toolbar:"bold italic underline strikethrough | bullist numlist | link image media | undo redo",relative_urls:!1},tiny_mce_opts_nota={width:"100%",theme:"modern",plugins:"autolink,link,image,media",menubar:!1,statusbar:!1,toolbar:"bold italic underline strikethrough | bullist numlist | link image media | undo redo",relative_urls:!1};
function onSuccess(a){"success"==a.response&&(a.url?window.location.href=a.url:$.pnotify({title:"Info",text:"Impostazioni salvate"}))}function onError(a,b,c){window.console&&console.log("textStatus: "+b+" errorThrown: "+c);window.location.href="/"}function floodUpdate(){time_left-=1;0==time_left&&$("#flood_error").modal("hide");message=time_left+" second";message=1==time_left?message+"o":message+"i";span.html(message)}
function onFloodError(a,b){$(".main").append(a.html);$("#flood_error").modal();$("#flood_error").on("hide",function(){clearInterval(floodErrorTimer);$("#flood_error").remove();b()});i=0;time_left=a.time;span=$(".seconds_left");floodUpdate();floodErrorTimer=setInterval(function(){floodUpdate()},980)}function getPostRootByElement(a){return a.parents(".s_post_root")}function getCommentRootByElement(a){return a.parents(".s_comment")}
function getPostElementByKey(a){return $('div[data-post-key="'+a+'"]')}function getPostKeyByElement(a){return getPostRootByElement(a).attr("data-post-key")}
function initPost(a){var b=a.find("form.s_new_comment_form");b.validate({ignore:"",errorClass:"error",errorPlacement:function(a,b){var e=$(b).parents(".form_parent");e.tooltip({title:a.text(),trigger:"manual"});e.tooltip("show")},highlight:function(a,b,e){$(a).parents(".form_parent").addClass(b)},unhighlight:function(a,b,e){$(a).parents(".form_parent").removeClass(b);$(a).tooltip("hide")},rules:{content:{required:!0,minlength:8}}});b.ajaxForm({clearForm:!0,dataType:"json",error:onError,success:function(b,
d,e,f){"success"!=b.response?"flooderror"==b.response?onFloodError(b,function(){}):onError():(a.find(".s_comment_list").append(b.html),a.find(".s_post_comment_num").text(b.num),a.find(".s_comment_submit").button("reset"),b=a.attr("data-post-key")?a.attr("data-post-key"):a.find(".s_post_root").attr("data-post-key"),tinymce.get("comment_content_"+b).setContent(""),b=a.find(".s_comment_list > li:last-child"),initComment(b))},beforeSubmit:function(b,d){a.find(".s_comment_submit").button("loading")}});
a.find(".s_post_comment").tinymce(tiny_mce_opts);a.find(".s_post_avatar").click(onAuthorDetail);a.find(".post_sub").click(onPostSubscribe);a.find(".post_unsub").click(onPostUnsubscribe);a.find(".post_del").click(onPostDelete);a.find(".post_pin").click(onPostPin);a.find(".post_collapse").click(onPostCollapse);a.find(".post_edit").click(onPostEdit);a.find(".post_reshare").click(onPostReshare);a.find(".post_vote").click(onPostVote);a.find(".post_unvote").click(onPostVote);a.find(".s_post_votes_c").click(onVotesDetail);
a.find(".s_post_reshares_c").click(onResharesDetail);a.find(".show_comment_form").click(onPostCommentFormExpand);a.find(".show_comment_form").click(onPostCommentsExpand);a.find(".post_comments_expand").click(onPostCommentsExpand);initComment(a)}
function initComment(a){a.find(".post_comment_del").click(onCommentDelete);a.find(".post_comment_edit").click(onCommentEdit);a.find(".post_comment_vote").click(onCommentVote);a.find(".post_comment_unvote").click(onCommentVote);a.find(".s_post_avatar").click(onAuthorDetail)}
function onPostEdit(){var a=getPostKeyByElement($(this)),b=getPostRootByElement($(this)),c=$(this).parents(".s_post_container"),d=b.find(".s_post_tools > .s_post_edit_form").clone(),e=b.attr("data-fullscreen");$.ajax({type:"POST",url:"/post/manage",data:{cmd:"edit_post",post:a,fullscreen:e},dataType:"json",error:onError,success:function(a){d.html(a.html);$(document).ready(function(){var a=d.find("form");a.validate({ignore:"",errorClass:"error",errorPlacement:function(a,b){var c=$(b).parents(".control-group");
c.tooltip({title:a.text(),trigger:"manual"});c.tooltip("show")},highlight:function(a,b,c){$(a).parents(".control-group").addClass(b)},unhighlight:function(a,b,c){$(a).parents(".control-group").removeClass(b);$(a).tooltip("hide")},rules:{content:{required:!0,minlength:8}}});a.ajaxForm({clearForm:!0,dataType:"html",error:onError,success:onEditSubmit,beforeSubmit:function(a,c){b.find(".post_edit_submit").button("loading")}});a=$('<div class="s_edit_undo" style="display:none;"></div>');a.append(c.contents());
b.append(a);c.empty();c.append(d);tinymce.remove("#"+d.find(".s_post_edit_content").attr("id"));d.find(".s_post_edit_content").tinymce(tiny_mce_opts);b.find(".s_post_commands").hide();d.show();d.find('input[name="attach_file"]').change(addAttach);d.find(".post_attach_delete").click(onAttachDelete);d.find(".post_edit_cancel").click(onEditCancel)})}})}
var onEditCancel=function(){var a=getPostRootByElement($(this)),b=$(this).parents(".s_post_container"),c=a.find(".s_edit_undo");b.empty();b.append(c.contents());c.remove();a.find(".s_post_commands").show();a.find(".s_post_attachs").show();return!1};function onEditSubmit(a){a=$(a);getPostElementByKey(a.attr("data-post-key")).replaceWith(a);initPost(a.parent())}
function onCommentEdit(){var a=getPostRootByElement($(this)),b=getCommentRootByElement($(this)),c=b.attr("data-comment-key"),a=a.find(".s_post_tools > .s_comment_edit_form").clone(),d=a.find("form");d.validate({ignore:"",errorClass:"error",errorPlacement:function(a,b){var c=$(b).parents(".control-group");c.tooltip({title:a.text(),trigger:"manual"});c.tooltip("show")},highlight:function(a,b,c){$(a).parents(".control-group").addClass(b)},unhighlight:function(a,b,c){$(a).parents(".control-group").removeClass(b);
$(a).tooltip("hide")},rules:{content:{required:!0,minlength:8}}});d.find('[name="comment"]').attr("value",c);d.ajaxForm({clearForm:!0,dataType:"json",error:onError,success:onCommentSubmit});a.find(".s_comment_edit_content").attr("value",$(this).parents(".s_post_container").find(".s_post_content").html());b.find(".s_edit_hollow").append(a);tinymce.remove("#"+a.find(".s_comment_edit_content").attr("id"));a.find(".s_comment_edit_content").tinymce(tiny_mce_opts);b.find(".s_post_commands").hide();b.find(".s_post_content").hide();
a.find(".s_comment_edit_form").show();a.show();a.find(".post_comment_cancel").click(onCommentEditCancel)}function onCommentSubmit(a){if("success"!=a.response&&"flooderror"==a.response)onFloodError(a,function(){});else{var b=$('[data-comment-key="'+a.comment+'"]');b.html(a.html);$(document).ready(function(){initComment(b)})}}
var onCommentEditCancel=function(){var a=getCommentRootByElement($(this));a.find(".s_comment_edit_form").hide();a.find(".s_post_content").show();a.find(".s_post_commands").show();a.find(".s_edit_hollow").empty();return!1};
function onAttachDelete(){var a=$(this).parents("form"),b=$(this).parents(".s_attach"),c=b.attr("data-attach-key");if(c){var d=$('<input type="hidden" name="attach_delete">');d.attr("value",c);a.append(d);b.remove()}else $(this).parents(".s_attach").find('input[type="file"]').attr("value","")}
function onPostExpand(){var a=$(this).hasClass("s_post_comments_c"),b=getPostKeyByElement($(this)),c=$(this).parents(".s_post_item"),a={cmd:"expand_post",post:b,exp_comments:a};c.append('<div class="s_loading"><span class="offset3 span2">Loading... <img src="/img/loading.gif"></span></div>');$.ajax({type:"POST",url:"/post/manage",data:a,dataType:"json",error:onError,success:function(a){c.html(a.html);$(document).ready(function(){initPost(c)})}})}
function onPostCollapse(){var a=getPostKeyByElement($(this)),b=$(this).parents(".s_post_item"),a={cmd:"collapse_post",post:a};tinymce.remove("#"+b.find(".s_post_comment").attr("id"));$.ajax({type:"POST",url:"/post/manage",data:a,dataType:"json",error:onError,success:function(a){a=$(a.html);b.replaceWith(a);b=a;initPostList(b)}})}function onPostCommentsExpand(){getPostRootByElement($(this)).find(".s_comment_list").show()}
function onPostCommentExpandEx(){var a=getPostKeyByElement($(this)),b=$(this).parents(".s_post_comment_num");$.ajax({type:"POST",url:"/post/manage",data:{cmd:"expand_comments",post:a},dataType:"json",error:onError,success:function(a){b.html(a.html)}})}function onPostCommentFormExpand(){$(this).parents(".s_comment_form").find("li.s_comment_form").show();$(this).parents(".s_comment_form").find("li.s_comment_placeholder").hide()}
function onOpenPostForm(){$("#new_post").is(":visible")?$("#new_post").slideUp():$("#new_post").slideDown()}function onOpenPostFormCancel(){$("#new_post_form .post_attachments .clone").remove();$("#new_post").slideUp()}
function onPostReshare(){var a=getPostKeyByElement($(this)),b=getPostRootByElement($(this)),c=b.attr("data-fullscreen");$.ajax({type:"POST",url:"/post/manage",data:{cmd:"reshare_modal",post:a,fullscreen:c},dataType:"json",error:onError,success:function(c){var e=b.find(".s_post_tools").find(".s_modal_reshare");e.html(c.html);$(document).ready(function(){e.find("[data-loading-text]").button();e.find('input[name="post"]').attr("value",a);tinymce.remove("#reshare_post_content_text");e.find("#reshare_post_content_text").tinymce(tiny_mce_opts);
e.find("form").ajaxForm({beforeSubmit:function(){e.find("[data-loading-text]").button("loading")},clearForm:!0,dataType:"json",error:onError,success:function(a){"success"!=a.response&&"flooderror"==a.response?(e.modal("hide"),onFloodError(a,function(){e.modal("show")})):0<$("#main_stream_list").length?($("#main_stream_list").prepend(a.html),a=$("#main_stream_list li:first-child"),initPostList(a),e.modal("hide"),e.empty()):onSuccess(a)}});e.show();e.modal()})}})}
function onPostVote(){var a=getPostKeyByElement($(this)),b=getPostRootByElement($(this)),c=$(this).attr("data-vote");$.ajax({type:"POST",url:"/post/manage",data:{cmd:"vote",key:a,vote:c},dataType:"json",error:onError,success:function(d){"success"!=d.response&&"flooderror"==d.response?onFloodError(d,function(){$("#reshare_"+a).modal("show")}):(b.find(".s_post_votes").html(d.votes),0<parseInt(d.votes)?b.find(".s_post_votes_c").show():b.find(".s_post_votes_c").hide(),1==parseInt(c)?(b.find(".post_vote").hide(),
b.find(".post_unvote").show()):(b.find(".post_vote").show(),b.find(".post_unvote").hide()))}})}
function onCommentVote(){var a=getCommentRootByElement($(this)),b=a.attr("data-comment-key"),c=$(this).attr("data-vote");$.ajax({type:"POST",url:"/post/manage",data:{cmd:"vote",key:b,vote:c},dataType:"json",error:onError,success:function(b){"success"!=b.response&&"flooderror"==b.response?onFloodError(b,function(){$("#reshare_"+post).modal("show")}):(a.find(".s_post_votes").html(b.votes),0<parseInt(b.votes)?a.find(".s_post_votes_c").show():a.find(".s_post_votes_c").hide(),1==parseInt(c)?(a.find(".post_comment_vote").hide(),
a.find(".post_comment_unvote").show()):(a.find(".post_comment_vote").show(),a.find(".post_comment_unvote").hide()))}})}
function onCommentDelete(){var a=getCommentRootByElement($(this)),b=getPostRootByElement($(this)).find(".s_post_comment_num"),c={cmd:"delete_comment",comment:a.attr("data-comment-key")};confirm("Sei sicuro di voler cancellare il commento?")&&$.ajax({type:"POST",url:"/post/manage",data:c,dataType:"json",error:onError,success:function(c){a.hide();a.remove();b.text(c.num);$.pnotify({title:"Info",text:"Commento cancellato"})}})}
function onPostPin(){var a=getPostKeyByElement($(this)),b=$(this).attr("data-days");$.ajax({type:"POST",url:"/post/manage",data:{cmd:"pin_post",post:a,days:b},dataType:"json",error:onError,success:function(a){$.pnotify({title:"Info",text:"Post evidenziato"})}})}
function onPostDelete(){var a=getPostKeyByElement($(this));confirm("Sei sicuro di voler cancellare il post?")&&$.ajax({type:"POST",url:"/post/manage",data:{cmd:"delete_open_post",post:a},dataType:"json",error:onError,success:function(a){window.location.href="/stream"}})}
function onPostItemDelete(){var a=getPostKeyByElement($(this));confirm("Sei sicuro di voler cancellare il post?")&&$.ajax({type:"POST",url:"/post/manage",data:{cmd:"delete_open_post",post:a},dataType:"json",error:onError,success:function(b){$('[data-post-key="'+a+'"]').remove()}})}
function onPostSubscribe(){var a={cmd:"subscribepost",post:getPostKeyByElement($(this))};$.ajax({url:"/post/subscribe",data:a,dataType:"json",error:onError,success:function(a){$("#postsub").hide();$("#postunsub").show();$.pnotify({title:"Info",text:"Sei iscritto a questo post"})}})}
function onPostUnsubscribe(a){a=getPostKeyByElement($(this));$.ajax({url:"/post/subscribe",data:{cmd:"unsubscribepost",post:a},dataType:"json",error:onError,success:function(a){$("#postsub").show();$("#postunsub").hide();$.pnotify({title:"Info",text:"Non sei pi\u00f9 iscritto a questo post"})}})}
function redraw_node(a){var b=a.attr("data-sub-status"),c=a.attr("data-ntfy-period");a.find(".ntfy_period > i").css("visibility","hidden");"true"==b?(a.find("#subscribe_btn").html("Disiscriviti"),a.find("#sub_prop").removeAttr("disabled"),a.find("#add_new").removeAttr("disabled"),a.find("#add_new").removeAttr("title"),a.find("#ntfy_period_"+c+" > i").css("visibility","visible")):(a.find("#sub_prop").attr("disabled","true"),a.find("#add_new").attr("disabled","true"),a.find("#subscribe_btn").html("Iscriviti"),
a.find("#add_new").attr("title","Iscriviti per aggiungere un messaggio"))}function onSubUnsubNode(){var a=$(this).parents(".node_root"),b=a.attr("data-node-key"),c=a.attr("data-sub-status");$.ajax({url:"/node/subscribe",data:{node:b,cmd:"true"==c?"unsubscribe":"subscribe"},dataType:"JSON",error:onError,success:function(b){a.attr("data-sub-status",b.subscribed);a.attr("data-ntfy-period",b.ntfy_period);onSuccess(b);$(document).ready(function(){redraw_node(a)})}})}
function onNotificationPeriod(){var a=$(this).parents(".node_root"),b=a.attr("data-node-key"),c=$(this).attr("data-ntfy-period");$.ajax({url:"/node/subscribe",data:{cmd:"set_ntfy_period",node:b,ntfy_period:c},dataType:"JSON",error:onError,success:function(b){a.attr("data-ntfy-period",c);onSuccess(b);redraw_node(a)}})}
function onNotificationPeriodProfile(){var a=$(this).parents(".node_root"),b=a.attr("data-node-key"),c=$(this).attr("data-ntfy-period");$.ajax({url:"/node/subscribe",data:{cmd:"set_ntfy_period",node:b,ntfy_period:c},dataType:"JSON",error:onError,success:function(b){a.attr("data-ntfy-period",c);a.find(".ntfy_period").removeClass("btn-primary");a.find('[data-ntfy-period="'+c+'"]').addClass("btn-primary");onSuccess(b)}})}
function init_search(){$("#search_text").typeahead({minLength:2,source:function(a,b){$("#search_node_list").empty();$("#loading").show();return $.post("/node/paginate",{query:a,cmd:"search_nodes"},function(a){$("#loading").hide();a=jQuery.parseJSON(a);a.html&&($("#search").tab("show"),$("#search_node_list").html(a.html))})}})}function onSearchPaginate(){var a=$(this).attr("data-offset");$('input[name="offset"]').attr("value",a);$("div.active > form").submit()}
function onNodeClick(){var a=$(this),b=a.attr("data-node-key");a.parent().siblings(".active").removeClass("active");a.parent().addClass("active");var c=a.find(".node_name").attr("title");$("#node_title").find("span").text(c);"all"!=b&&"news"!=b?($("#node_title > a").attr("href","/node/"+b),$("#node_title > a").show(),a.find(".sub_ntfy").hide()):$("#node_title > a").hide();a.parent().addClass("active");$("#node_container").empty();loadNode(b,c)}
function initNode(a){$("#new_post_form").validate({ignore:"",errorClass:"error",errorPlacement:function(a,c){var d=$(c).parents(".control-group");d.tooltip({title:a.text(),trigger:"manual"});d.tooltip("show")},highlight:function(a,c,d){$(a).parents(".control-group").addClass(c)},unhighlight:function(a,c,d){$(a).parents(".control-group").removeClass(c);$(a).tooltip("hide")},rules:{content:{required:!0,minlength:8}}});$("#post_content_text").tinymce(tiny_mce_opts);$("#new_post_form").ajaxForm({clearForm:!0,
dataType:"html",error:onError,success:function(a){$("#main_stream_list").prepend(a);$("#open_post_submit").button("reset");$("#new_post_form .post_attachments .clone").remove();a=$("#main_stream_list li:first-child");initPostList(a);tinymce.get("post_content_text").setContent("")},beforeSubmit:function(a,c){$("#open_post_submit").button("loading");$("#new_post").slideUp()}});$("#subscribe_btn").on("click",onSubUnsubNode);$(".ntfy_period").on("click",onNotificationPeriod);$("#more_posts").click(onMoreClick);
"all"!=a&&"news"!=a&&redraw_node($(".node_root"));$('input[name="attach_file"]').change(addAttach);$(".post_attach_delete").click(onAttachDelete)}function init_ntfy(){var a=$("#ntf_cnt");a.attr("data-visible","false");a.popover({html:!0,trigger:"manual"}).click(function(a){onOpenNotifications(a)});$(document).click(function(a){$('[data-visible="true"].s_popover').each(function(){$(this).popover("hide");$(this).attr("data-visible","false")})})}
function init_node(a){$("ul#node_list a[data-node-key]").click(onNodeClick);0<$("#node_list a[data-node-key='"+a+"']").lenght?$("#node_list a[data-node-key='"+a+"']").first().click():$("ul#node_list a[data-node-key]").first().click()}
function onOpenNotifications(a){var b={cmd:"ntfy_summary"};"false"==$("#ntf_cnt").attr("data-visible")&&$.ajax({type:"POST",url:"/ntfctn/paginate",data:b,dataType:"json",error:onError,success:function(b){var d=$("#ntf_cnt");d.attr("data-content",b.html);d.popover("show");d.attr("data-visible","true");$(".s_glob_ntfy").text("0");$(".s_glob_ntfy").removeClass("badge-warning");a.preventDefault()}})}
function addAttach(){var a=$(this),b=a.clone();b.addClass("clone");b.appendTo(a.parent());b.change(addAttach)}function onMoreClick(){var a=$(this).parents(".node_root").attr("data-node-key");loadPosts(a,$("#main_stream").attr("next_cursor"))}
function loadNode(a,b){$.ajax({type:"POST",url:"/node/paginate",data:{cmd:"node_main",node:a,node_name:b},dataType:"json",error:onError,success:function(b){"success"==b.response&&(tinymce.remove(),$("#node_container").empty(),$("#node_container").append(b.html),$(document).ready(function(){initNode(a);loadPosts(a,"")}))}})}
function loadPosts(a,b){$("#main_stream_list").append('<li class="s_loading"><span class="offset3 span2">Loading... <img src="/img/loading.gif"></span></li>');$.ajax({type:"POST",url:"/post/paginate",data:{cmd:"post_main",node:a,cursor:b},dataType:"json",error:onError,success:function(b){$("#form_node").attr("value",a);$("#main_stream").attr("next_cursor",b.cursor);if("success"==b.response){var d=$(b.html);$("#main_stream_list").find("li.s_loading").remove();initPostList(d);$("#main_stream_list").append(d);
b.eof?($("#more_posts").hide(),$("#no_more_posts").show(),$("#no_more_posts").alert()):($("#more_posts").show(),$("#no_more_posts").hide())}}})}
function initPostList(a){a.find(".post_del").click(onPostItemDelete);a.find(".post_sub").click(onPostSubscribe);a.find(".post_unsub").click(onPostUnsubscribe);a.find(".post_vote").click(onPostVote);a.find(".post_unvote").click(onPostVote);a.find(".post_reshare").click(onPostReshare);a.find(".post_expand").click(onPostExpand);a.find(".s_post_avatar").click(onAuthorDetail);a.find(".s_post_votes_c").click(onVotesDetail);a.find(".s_post_reshares_c").click(onResharesDetail)}
function onVotesDetail(){var a="",a=getCommentRootByElement($(this)),a=0<a.length?a.attr("data-comment-key"):getPostKeyByElement($(this));$.ajax({type:"POST",url:"/post/manage",data:{cmd:"vote_list",key:a},dataType:"json",error:onError,success:function(a){$("body").append(a.html);$("#votes_modal").modal()}})}
function onResharesDetail(){var a={cmd:"reshare_list",post:getPostKeyByElement($(this))};$.ajax({type:"POST",url:"/post/manage",data:a,dataType:"json",error:onError,success:function(a){$("body").append(a.html);$("#reshares_modal").modal()}})}
function onAuthorDetail(){var a=$(this),b="",b=getCommentRootByElement($(this)),b=0<b.length?b.attr("data-comment-key"):getPostKeyByElement($(this));$.ajax({type:"POST",url:"/post/manage",data:{cmd:"author_detail",key:b},dataType:"json",error:onError,success:function(b){a.attr("data-content",b.html);a.popover("show");a.attr("data-visible","true")}})}
function loadNotifications(){var a={cmd:"notifications",cursor:$("#notifications_list").attr("data-cursor")};$.ajax({type:"POST",url:"/ntfctn/paginate",data:a,dataType:"json",error:onError,success:function(a){"success"==a.response&&($("#notifications_list").attr("data-cursor",a.cursor),$("#notifications_list").last().append(a.html));a.eof&&($("#load_notifications").hide(),0<$("#notifications_list").children().length?$(".no_more_data").show():$(".empty_errors").show())}})}
function mark_visited(){$("div.notification").each(function(){date=new Date(this.attr("date"))})};var ulmsg=!1;window.onbeforeunload=closeAlert;function closeAlert(){if(ulmsg)return confirm("Attenzione, la pagina contiene dati non salvati, uscire comunque ?")?($(".tooltip").remove(),ulmsg=!1,!0):!1}function closedialog(){cleardirty();$(".tooltip").remove();$("#new-data").find(".error").tooltip("hide");$("#new-data").dialog("close")}function cleardirty(){ulmsg=!1}
function initForm(){ulmsg=!0;$("#new-data-form").find("[data-content]").popover({delay:{show:500,hide:1E3},title:"Informazioni"});$("#new-data").find("[type='radio']").button()}var auto_open_nc=!1;jQuery.validator.addMethod("numpastibambini",function(a,b){return parseInt(a)<=parseInt($("#e_numeroPastiTotale").val())});jQuery.validator.addMethod("numpastispeciali",function(a,b){return a<=parseInt($("#e_numeroPastiBambini").val())});
function opennewwiz(a){$("#new-data-form").load(a,function(){initForm();$("#form0").formwizard({formPluginEnabled:!0,validationEnabled:!0,validationOptions:{errorClass:"error",errorPlacement:function(a,c){var d=$(c).parents(".control-group");d.tooltip({title:a.text(),trigger:"manual"});d.tooltip("show")},highlight:function(a,c,d){$(a).parents(".control-group").addClass(c)},unhighlight:function(a,c,d){a=$(a).parents(".control-group");a.removeClass(c);a.tooltip("hide")}},focusFirstInput:!0,textNext:"Avanti",
textBack:"Indietro",disableUIStyles:!0,remoteAjax:{step1:{url:a+"val",dataType:"text",success:function(a){if("Ok"!=a)return $("#error-container").text(a),$("#error-container").dialog({modal:!0,width:"40em",zIndex:3,title:"Attenzione",autoOpen:!1,buttons:[{text:"Ok",click:function(){$(this).dialog("close");$("#error-container").text("")}}]}),$("#error-container").dialog("open"),!1;$("#formwiz-error").alert("close");return!0}}},formOptions:{success:function(a){$("#new-data-preview").html(a);$("#form-error").html()?
($("#form-error").dialog({modal:!0,width:"40em",zIndex:3,autoOpen:!1,buttons:[{text:"Ok",click:function(){$("#form-error").detach();$(this).dialog("close");$("#e_submit").button("reset")}}]}),$("#form-error").dialog("open"),$("#new-data-preview").html("")):($("#new-data-form").hide(),$("#new-data-preview").show(),$("#form1").find("#node").val($("#form_node").val()),$("#activity_list li:first-child").attr("id")&&$("#form1").find("#act_last").val($("#activity_list li:first-child").attr("id").substring(9)),
$("#form1").ajaxForm({error:onError,dataType:"html",beforeSubmit:function(){$("#form1").find("#e_submit").button("loading")},success:function(a){$("#new-data").dialog("close");$("#new-data-form").html("");$("#new-data-preview").html("");$("#main_stream_list").prepend(a);a=$("#main_stream_list li:first-child");initPostList(a);auto_open_nc&&($("#new-nc").html("Inserire anche una Non conformit&agrave; ?"),$("#new-nc").dialog({title:"Nuova Non conformit&agrave;",modal:!0,width:"40em",zIndex:3,autoOpen:!1,
buttons:[{text:"Si",click:function(){$(this).dialog("close");opennewnc()}},{text:"No",click:function(){$(this).dialog("close");auto_open_nc=!1}}]}),$("#new-nc").dialog("open"))}}))},resetForm:!1,beforeSubmit:function(a,c){$("#form0").find("#e_submit").button("loading")}}});$.validator.messages={number:"Inserire in numero",required:"Inserire o selezionare un valore",range:"Inserire un valore compreso tra {0} e {1}",numpastibambini:"Il numero di pasti serviti ai bambini deve essere inferiore al numero di pasti totali.",
numpastispeciali:"Il numero di pasti speciali deve essere inferiore al numero di pasti serviti ai bambini."};$("#form0").bind("step_shown",function(a,c){$("#formwiz-progress-"+c.previousStep).removeClass("active");$("#formwiz-progress-"+c.currentStep).addClass("active")});$("#new-data").show();$("#new-data-form").show();$("#formwiz-progress-step1").toggleClass("active");$("#new-data").dialog({title:$("#title").text(),modal:!0,height:600,width:810,zIndex:2,autoOpen:!1,beforeClose:closeAlert});$("#new-data").dialog("open")})}
function opennewitem(a){$("#new-data-form").load(a,function(){initForm();$.validator.messages={required:"Inserire o selezionare un valore",range:"Inserire un valore compreso tra {0} e {1}"};$("#form0").validate({errorClass:"error",errorPlacement:function(a,c){var d=$(c).parents(".control-group");d.tooltip({title:a.text(),trigger:"auto"});d.tooltip("show");$("#e_submit").button("reset")},highlight:function(a,c,d){$(a).parents(".control-group").addClass(c)},unhighlight:function(a,c,d){a=$(a).parents(".control-group");
a.removeClass(c);a.tooltip("hide")}});$("#form0").ajaxForm({error:onError,clearForm:!1,success:function(a){$("#new-data-preview").html(a);$("#new-data-preview").find("#form-error").html()?(a=$("#new-data-preview").find("#form-error"),a.dialog({modal:!0,width:"40em",zIndex:3,autoOpen:!1,buttons:[{text:"Ok",click:function(){$(this).dialog("close");$("#new-data-preview").find("#form-error").detach();$("#e_submit").button("reset")}}]}),a.dialog("open")):($("#new-data-form").hide(),$("#new-data-preview").show(),
$("#form1").find("#node").val($("#form_node").val()),$("#activity_list li:first-child").attr("id")&&$("#form1").find("#act_last").val($("#activity_list li:first-child").attr("id").substring(9)),$("#form1").ajaxForm({error:onError,dataType:"html",beforeSubmit:function(){$("#form1").find("#e_submit").button("loading")},success:function(a){$("#new-data").dialog("close");$("#new-data-form").html("");$("#new-data-preview").html("");$("#main_stream_list").prepend(a);a=$("#main_stream_list li:first-child");
initPostList(a);auto_open_nc&&($("#new-nc").html("Inserire altra Non conformit&agrave; ?"),$("#new-nc").dialog({title:"Nuova Non conformit&agrave;",modal:!0,width:"40em",zIndex:3,autoOpen:!1,buttons:[{text:"Si",click:function(){$(this).dialog("close");opennewnc()}},{text:"No",click:function(){$(this).dialog("close");auto_open_nc=!1}}]}),$("#new-nc").dialog("open"))}}))},beforeSubmit:function(a,c){$("#form0").find("#e_submit").button("loading")}});$("#new-data").show();$("#new-data-form").show();$("#new-data").dialog({title:$("#title").text(),
modal:!0,height:550,width:810,zIndex:2,autoOpen:!1,beforeClose:closeAlert});$("#new-data").dialog("open")})}function onclosenewitem(){ulmsg=!1;$("#new-data").dialog("close");return!1}function opennewisp(){auto_open_nc=!0;$("#new-data-form").html("");$("#new-data-preview").html("");opennewwiz("/isp/isp")}function opennewnc(){auto_open_nc=!0;$("#new-data-form").html("");$("#new-data-preview").html("");opennewitem("/isp/nc")}
function opennewdieta(){$("#new-data-form").html("");$("#new-data-preview").html("");opennewwiz("/isp/dieta")}function opennewnota(){$("#new-data-form").html("");$("#new-data-preview").html("");opennewitem("/isp/nota")}function previewback(){$("#e_submit").button("reset");$("#new-data-preview").hide();$("#new-data-form").show()};var infowindow,locations={},list,xml=null,map,iLast,locArray,offset=0,markersArray=[],lat,lon,image=new google.maps.MarkerImage("http://google-maps-icons.googlecode.com/files/school.png",new google.maps.Size(32,37),new google.maps.Point(0,0),new google.maps.Point(16,37)),shadow=new google.maps.MarkerImage("http://google-maps-icons.googlecode.com/files/shadow.png",new google.maps.Size(51,37),new google.maps.Point(0,0),new google.maps.Point(16,37)),fluster=null,fstyles={0:{image:"https://raw.githubusercontent.com/googlemaps/js-marker-clusterer/gh-pages/images/m1.png",
textColor:"#FFFFFF",width:53,height:52},10:{image:"https://raw.githubusercontent.com/googlemaps/js-marker-clusterer/gh-pages/images/m2.png",textColor:"#FFFFFF",width:56,height:55},20:{image:"https://raw.githubusercontent.com/googlemaps/js-marker-clusterer/gh-pages/images/m3.png",textColor:"#FFFFFF",width:66,height:65}};
function drawMap(a){var b=$("#e_citta").val(),c=$("#e_z").val(),d=$("#e_cc").val(),e=$("#e_tipo").val(),f=$("#e_numcm").val();jmarkers=jQuery(a);jmarker=jmarkers.find("marker");jmarker.each(function(){var a=jQuery(this),h=a.attr("key"),k=a.attr("nome"),l=a.attr("indirizzo"),g=a.attr("tipo"),m=a.attr("numcm"),n=a.attr("citta"),p=a.attr("zona"),q=a.attr("cc");b&&n!=b||c&&p!=c||d&&q!=d||e&&g!=e||!(0==f||0<m)||(a=new google.maps.LatLng(parseFloat(a.attr("lat")),parseFloat(a.attr("lon"))),createMarker({key:h,
latlng:a,name:k,address:l,type:g}))});jmarkers.find("markers").attr("cur")?(offset+=1,jQuery.get("/map?cmd=all&cur="+jmarkers.find("markers").attr("cur")+"&offset="+offset,{},drawMap)):($("#loading").hide(),fluster.initialize())}
function redraw(){$("#loading").show();$("#l_citta").html($("#e_citta option[value='"+$("#e_citta").val()+"']").text());var a={zoom:12,center:new google.maps.LatLng(lat,lon),mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map_canvas"),a);list.children().remove();for(a=list.lenght=0;a<markersArray.length;a++)markersArray[a].setMap(null);offset=markersArray.length=0;fluster=new Fluster2(map);fluster.styles=fstyles;jQuery.get("/map?cmd=all",{},drawMap)}
function load(a,b){lat=a;lon=b;list=$("#left_list");redraw()}
function createMarker(a){var b=new google.maps.Marker({position:a.latlng,icon:image,shadow:shadow});fluster.addMarker(b);markersArray.push(b);var c="<div id='info'><ul class='nav nav-tabs'><li class='active'><a href='#general' data-toggle='tab'>Generale</a></li></ul><div class='tab-contents' id='content'><div id='general'><b>Nome: "+a.name+"<br/>Tipo: "+a.type+"</b><br/>Indirizzo: "+a.address+"</div></div><a class='btn btn-normal' href='/node/res/"+a.key+"/cm'>Post</a><a class='btn btn-normal' href='/contatti?cm="+
a.key+"'>Contatti</a></div>",d=function(){infowindow&&infowindow.close();infowindow=new google.maps.InfoWindow({content:c});infowindow.open(map,b);google.maps.event.addListener(infowindow,"domready",function(){$("#tabs").tabs()})};google.maps.event.addListener(b,"click",d);addLocationToList(list,a,b,d);return b}
function addLocationToList(a,b,c,d){itm=document.createElement("div");itm.style.cursor="hand";itm.innerHTML="<b>"+b.name+" - "+b.type+"</b> <br/>"+b.address+"";itm.addEventListener&&itm.addEventListener("click",d);a.append(itm)}
function drawSmallMap(a){jmarkers=jQuery(a);jmarker=jmarkers.find("marker");jmarker.each(function(){var a=jQuery(this);a.attr("nome");a.attr("indirizzo");a.attr("tipo");a=new google.maps.LatLng(parseFloat(a.attr("lat")),parseFloat(a.attr("lon")));a=new google.maps.Marker({position:a,icon:image,shadow:shadow});fluster.addMarker(a)});jmarkers.find("markers").attr("cur")?(offset+=1,jQuery.get("/map?cur="+jmarkers.find("markers").attr("cur")+"&offset="+offset,{},drawSmallMap)):fluster.initialize()}
function loadSmallMap(a,b){var c={zoom:4,center:new google.maps.LatLng(a,b),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,scrollwheel:!1,navigationControl:!1,scaleControl:!1,draggable:!1},c=new google.maps.Map(document.getElementById("map_canvas"),c);fluster=new Fluster2(c);new google.maps.MarkerImage("/img/school.png",new google.maps.Size(16,18),new google.maps.Point(0,0),new google.maps.Point(8,0));new google.maps.MarkerImage("/img/shadow.png",new google.maps.Size(26,19),new google.maps.Point(0,
0),new google.maps.Point(8,0));fluster=new Fluster2(c);fluster.styles=fstyles;jQuery.get("/map",{},drawSmallMap)};var cache={},lastXhr,city=null,combo_config={navi_simple:!0,lang:"it",select_only:!0,primary_key:"value",bind_to:"selected",field:"label",db_table:"citta",button_img:"/img/combobox_button.png",load_img:"/img/ajax-loader.gif",sub_info:!1},init_value="";
function oncitychanged(){combo_config.init_record=init_value;if(""!=$("#citta").val()&&$("#citta").val()!=city)if(cache[$("#citta").val()])city=$("#citta").val(),$("#commissione_sel").parent().html('<input class="" id="commissione_sel" name="commissione_sel"/><input type="hidden" id="cm" name="cm" value=""/>'),$("#commissione_sel").ajaxComboBox(cache[city],combo_config).bind("selected",function(a,c){$("#cm").val($("#commissione_sel_hidden").val())});else{var a={city:$("#citta").val()};lastXhr=$.getJSON("/profilo/getcm",
a,function(a,c,d){city=$("#citta").val();cache[city]=a;$("#commissione_sel").parent().html('<input class="" id="commissione_sel" name="commissione_sel"/><input type="hidden" id="cm" name="cm" value=""/>');$("#commissione_sel").ajaxComboBox(a,combo_config).bind("selected",function(a,b){$("#cm").val($("#commissione_sel_hidden").val())})})}}
function showDishDetails(a){if(!isVisible){var b=$(a.target),c={cmd:"getdetails",piatto:b.attr("data-detail-key"),cm:b.attr("data-detail-cm")};$.ajax({url:"/menu",data:c,dataType:"json",success:function(c){var e="<h5>"+c.piatto+"</h5><ul class='unstyled'>",e=e+"<li><spam>Ingrediente</span><span style='float:right;'>g.</span></li>",f;for(f in c.ingredienti)e+="<li><spam>"+c.ingredienti[f].nome+"</span><span style='float:right;'>"+Math.round(10*c.ingredienti[f].quantita)/10+"</span></li>";b.attr("data-content",
e+"</ul>");b.popover("show");isVisible=!0;a.preventDefault()}})}}$.pnotify.defaults.delay=5E3;var getMenu=function(){var a=$("#e_dataIspezione").val(),b=$("#e_commissione").val();a&&b&&$.ajax({url:"/menu?cmd=getbydate&data="+a+"&commissione="+b,success:function(a){a=eval("("+a+")");a.primo?($("#e_primoPrevisto").attr("readonly",!0),$("#e_secondoPrevisto").attr("readonly",!0),$("#e_contornoPrevisto").attr("readonly",!0),$("#e_primoPrevisto").removeClass("required"),$("#e_secondoPrevisto").removeClass("required"),$("#e_contornoPrevisto").removeClass("required"),$("#e_primoPrevisto").val(a.primo),
$("#e_secondoPrevisto").val(a.secondo),$("#e_contornoPrevisto").val(a.contorno),$("#e_primoEffettivo").val(a.primo),$("#e_secondoEffettivo").val(a.secondo),$("#e_contornoEffettivo").val(a.contorno),$("#e_primoPiattoEffettivo").val(a.primo_key),$("#e_secondoPiattoEffettivo").val(a.secondo_key),$("#e_contornoPiattoEffettivo").val(a.contorno_key),onMenuChanged()):($("#e_primoPrevisto").attr("readonly",!1),$("#e_secondoPrevisto").attr("readonly",!1),$("#e_contornoPrevisto").attr("readonly",!1),$("#e_primoPrevisto").addClass("required"),
$("#e_secondoPrevisto").addClass("required"),$("#e_contornoPrevisto").addClass("required"),$("#e_primoPrevisto").change(function(){$("#e_primoEffettivo").val($("#e_primoPrevisto").val())}),$("#e_secondoPrevisto").change(function(){$("#e_secondoEffettivo").val($("#e_secondoPrevisto").val())}),$("#e_contornoPrevisto").change(function(){$("#e_contornoEffettivo").val($("#e_contornoPrevisto").val())}))}})};
function onMenuChanged(){""!=$("#e_primoEffettivo").val()&&$("#e_primoEffettivo").val()==$("#e_secondoEffettivo").val()?($("#s_secondo_1").css("display"),$("#s_secondo_2").css("display"),$("#s_secondo_3").css("display"),piattounico=!0,$("#tab_primo").text("Piatto unico"),$("#tab_secondo").parent().hide(),$("#s_primo").html($("#e_primoEffettivo").val()),$("#step3next").val("step5")):(piattounico=!1,$("#tab_primo").text("Primo"),$("#tab_secondo").parent().show(),$("#s_primo").text($("#e_primoEffettivo").val()),
$("#s_secondo").text($("#e_secondoEffettivo").val()),$("#step3next").val("step4"));$("#s_contorno").text($("#e_contornoEffettivo").val());$("#form0").find("#e_submit").removeAttr("disabled")}
function getPrevIspData(){getMenu();var a=$("#e_commissione").attr("value");$('[name="aaRispettoCapitolato"]')[0].checked!=$('[name="aaRispettoCapitolato"]')[1].checked&&a&&!window.confirm("Caricare i dati 'ambientali' da precedente scheda inserita per la Commissione ?")||$.ajax({url:"/isp/getispdata?cm="+a,success:function(a){a=a.split("|");1<a.length&&($($('[name="aaRispettoCapitolato"]')[0==a[0]?1:0]).parent().click(),$($('[name="aaRispettoCapitolato"]')[0==
a[0]?1:0]).attr("checked",!0),$($('[name="aaTavoliApparecchiati"]')[0==a[1]?1:0]).parent().click(),$($('[name="aaTavoliApparecchiati"]')[0==a[1]?1:0]).attr("checked",!0),$($('[name="aaTermichePulite"]')[0==a[2]?1:0]).parent().click(),$($('[name="aaTermichePulite"]')[0==a[2]?1:0]).attr("checked",!0),$($('[name="aaAcqua"]')[0==a[3]?1:0]).parent().click(),$($('[name="aaAcqua"]')[0==a[3]?1:0]).attr("checked",!0),$($('[name="aaScaldaVivande"]')[0==a[4]?1:0]).parent().click(),$($('[name="aaScaldaVivande"]')[0==
a[4]?1:0]).attr("checked",!0),$($('[name="aaSelfService"]')[0==a[5]?1:0]).parent().click(),$($('[name="aaSelfService"]')[0==a[5]?1:0]).attr("checked",!0),$($('[name="aaTabellaEsposta"]')[0==a[6]?1:0]).parent().click(),$($('[name="aaTabellaEsposta"]')[0==a[6]?1:0]).attr("checked",!0),$($('[name="ricicloStoviglie"]')[0==a[7]?1:0]).parent().click(),$($('[name="ricicloStoviglie"]')[0==a[7]?1:0]).attr("checked",!0),$($('[name="ricicloPosate"]')[0==a[8]?1:0]).parent().click(),$($('[name="ricicloPosate"]')[0==
a[8]?1:0]).attr("checked",!0),$($('[name="ricicloBicchieri"]')[0==a[9]?1:0]).parent().click(),$($('[name="ricicloBicchieri"]')[0==a[9]?1:0]).attr("checked",!0))}})}function createCookie(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString()}else c="";document.cookie=a+"="+b+c+"; path=/"}
function readCookie(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null}function eraseCookie(a){createCookie(a,"",-1)};var tour=new Tour({labels:{next:"Avanti \u00bb",prev:"\u00ab Indietro",end:"Fine"}});tour.addStep({element:".s_node_panel",title:"Argomenti",content:"<p>Tutti i dati sono pubblicati su un <strong>Argomento</strong>.</p><p>Un Argomento \u00e8 come un raccoglitore di messaggi.</p><p>Sono Argomenti le Scuole, le Citt\u00e0 e naturalmente gli argomenti in ambito all'alimentazione scolastica.",backdrop:!1});
tour.addStep({element:".s_node_panel [data-node-key='all']",title:"Seleziona argomento",content:"Questo link mostra <strong>tutti i messaggi degli argomenti a cui sei iscritto</strong>.",backdrop:!1,placement:"right"});
tour.addStep({element:".s_node_panel [data-node-key='news']",title:"Seleziona argomento",content:"Mentre questo link mostra <strong>tutti i messaggi pi\u00f9 recenti</strong>, anche di argomenti a cui non sei iscritto.",onShow:function(){$("#sub_nodes + li a").click()},backdrop:!1,placement:"right"});
tour.addStep({element:"#node_search",title:"Cerca Argomenti",content:"Naturalmente puoi cercare altri <strong>argomenti di tuo interesse</strong>: Scuole, Citt\u00e0, Zone, oppure argomenti di particolare interesse.",backdrop:!1,placement:"right"});tour.addStep({element:"#main_stream",title:"Messaggi",content:"Qui vengono <strong>mostrati i messaggi</strong>.",onShow:function(){$("#main_stream_list li:first-child .s_post_title_1").click()},backdrop:!1,placement:"top"});
tour.addStep({element:"#node_subscription",title:"Messaggi",content:"Qui <strong>controlli la tua iscrizione a un Argomento</strong>, e se e con che frequenza ricevere notifiche via mail.",backdrop:!1,placement:"bottom"});tour.addStep({element:"#add_new",title:"Messaggi",content:"Con questo pulsante puoi <strong>pubblicare messaggi su un Argomento</strong>.",backdrop:!1,placement:"right"});
tour.addStep({element:"#main_stream_list li:first-child .s_post_title",title:"Messaggi",content:"Clicca sul titolo del messaggio per <strong>mostrarne tutto il contenuto</strong>.",backdrop:!1,placement:"top"});tour.addStep({element:"#main_stream_list li:first-child .show_comment_form",title:"Messaggi",content:"Clicca qui per <strong>aggiungere un commento</strong>",backdrop:!1,placement:"bottom"});
tour.addStep({element:"#main_stream_list li:first-child .post_reshare",title:"Messaggi",content:"Puoi <strong>'inoltrare' un messaggio su un altro Argomento</strong>, ad esempio da una Scuola alla Citt\u00e0, o viceversa.",backdrop:!1,placement:"bottom"});tour.addStep({element:"#main_stream_list li:first-child .post_vote",title:"Messaggi",content:"Puoi <strong>esprimere il tuo 'gradimento' al post</strong> o al commento",backdrop:!1,placement:"bottom"});
tour.addStep({element:"#ntf_cnt",title:"Notifiche",content:"<p>Quando pubblichi un messaggio o un commento, le altre persone iscritte al sito ricevono delle <strong>notifiche</strong>.</p><p>Qui vedi il <strong>numero di notifiche che ti riguardano</strong>.</p>",backdrop:!1,placement:"bottom"});tour.addStep({element:"#ntf_cnt",title:"Notifiche",content:"<p>Cliccando sul numero, mostri l'<strong>elenco delle ultime notifiche</strong>, se presenti.</p>",backdrop:!1,placement:"bottom"});
tour.addStep({element:"#stream_nav",title:"Attivit\u00e0",content:"<p>Passiamo alle altre aree. Per tornare a questa area, clicca su 'Attivit\u00e0' oppure sul logo in alto a sinistra.</p>",backdrop:!1,placement:"bottom"});tour.addStep({element:"#nodes_nav",title:"Argomenti",content:"<p>Qui puoi <strong>consultare gli Argomenti</strong>, cercanoo nelle liste dei pi\u00f9 attivi o recenti.</p>",backdrop:!1,placement:"bottom"});
tour.addStep({element:"#menu_nav",title:"Menu",content:"<p>Qui puoi consultare il <strong>men\u00f9 previsto</strong>, se \u00e8 stato configurato per la Scuola selezionata</p>",backdrop:!1,placement:"bottom"});tour.addStep({element:"#stats_nav",title:"Statistiche",content:"<p>Qui puoi consultare le statistiche sgli indicatori del livello del servizio di ristorazione, elaborate dai dati inseriti nelle schede di ispezione delle <strong>Commissioni Mensa</strong></p>",backdrop:!1,placement:"bottom"});
tour.addStep({element:"#commissioni_nav",title:"Commissioni",content:"<p>Qui puoi consultare le <strong>Scuole</strong> sulla mappa della Citt\u00e0 selezionata.</p>",backdrop:!1,placement:"bottom"});tour.addStep({element:"#contatti_nav",title:"Contatti",content:"<p>Qui puoi consultare l'<strong>elenco degli altri iscritti</strong> al sito per Scuola</p>",backdrop:!1,placement:"bottom"});
tour.addStep({element:"#search_nav",title:"Ricerca",content:"<p>Puoi <strong>cercare i messaggi</strong> specificando le parole chiave, come in un normale motore di ricerca.</p>",backdrop:!1,placement:"bottom"});tour.addStep({element:"#start_tour",title:"Fine",content:"<p><strong>E con questo \u00e8 tutto</strong>.</p><p>Puoi <strong>riavviare questo 'tour' cliccando sul '?'</strong> qui in alto.</p><p>Ciao!.</p>",backdrop:!1,placement:"bottom"});
function start_tour(){tour.showStep(0);tour.start(!0)}function welcome_dialog(){$(".start_tour").click(function(){$("#welcome_dialog").modal("hide");start_tour()});$("#welcome_dialog").modal("show")};
